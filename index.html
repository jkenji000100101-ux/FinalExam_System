    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Furniture Haven - Online Shop Management</title>
        <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/sofa.png') }}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            /* Modern CSS Variables */
            :root {
                --primary: #2c3e50;
                --secondary: #3498db;
                --accent: #e67e22;
                --light: #f8f9fa;
                --dark: #2c3e50;
                --success: #2ecc71;
                --warning: #f39c12;
                --danger: #e74c3c;
                --gray: #95a5a6;
                --facebook: #3b5998;
                --google: #db4437;
                --phone: #27ae60;
                --background: #f9f9fa;
                --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
                --hover-shadow: 0 15px 30px rgba(0,0,0,0.15);
                --border-radius: 12px;
                --transition: all 0.3s ease;
                --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --gradient-accent: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }
            
            /* Global Reset & Base Styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            
            body {
                background-color: var(--background);
                color: var(--dark);
                line-height: 1.6;
                overflow-x: hidden;
            }
            
            .container {
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }
            
            .hidden {
                display: none !important;
            }
            
            /* Modern Button Styles */
            .btn {
                padding: 12px 20px;
                border: none;
                border-radius: var(--border-radius);
                cursor: pointer;
                font-weight: 600;
                transition: var(--transition);
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                position: relative;
                overflow: hidden;
            }
            
            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.5s;
            }
            
            .btn:hover::before {
                left: 100%;
            }
            
            .btn-primary {
                background: var(--gradient);
                color: white;
            }
            
            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            }
            
            .btn-success {
                background: var(--success);
                color: white;
            }
            
            .btn-success:hover {
                background: #27ae60;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
            }
            
            .btn-warning {
                background: var(--warning);
                color: white;
            }
            
            .btn-warning:hover {
                background: #e67e22;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
            }
            
            .btn-danger {
                background: var(--danger);
                color: white;
            }
            
            .btn-danger:hover {
                background: #c0392b;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
            }
            
            .btn-secondary {
                background: var(--gray);
                color: white;
            }
            
            .btn-secondary:hover {
                background: #7f8c8d;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
            }
            
            .btn-sm {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            /* Modern Header Styles */
            header {
                background-color: white;
                color: var(--dark);
                padding: 15px 0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                position: sticky;
                top: 0;
                z-index: 100;
                backdrop-filter: blur(10px);
            }
            
            .header-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .logo {
                font-size: 28px;
                font-weight: 700;
                color: var(--primary);
                text-decoration: none;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .logo span {
                background: var(--gradient-accent);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .logo i {
                color: var(--accent);
            }
            
            nav ul {
                display: flex;
                list-style: none;
            }
            
            nav ul li {
                margin-left: 20px;
                position: relative;
            }
            
            nav ul li a {
                color: var(--dark);
                text-decoration: none;
                font-weight: 500;
                transition: var(--transition);
                display: flex;
                align-items: center;
                padding: 8px 12px;
                border-radius: var(--border-radius);
            }
            
            nav ul li a i {
                margin-right: 5px;
            }
            
            nav ul li a:hover {
                color: var(--accent);
                background-color: rgba(230, 126, 34, 0.1);
            }
            
            nav ul li a::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 50%;
                width: 0;
                height: 2px;
                background: var(--gradient-accent);
                transition: var(--transition);
                transform: translateX(-50%);
            }
            
            nav ul li a:hover::after {
                width: 80%;
            }
            
            /* Profile logo styling */
            .profile-logo {
                font-size: 30px !important;
                padding: 8px !important;
            }

            .profile-logo i {
                margin-right: 0 !important;
            }

            /* Hide customer navigation for admin */
            .admin-nav .customer-nav {
                display: none !important;
            }

            .cart-badge {
                background: var(--gradient-accent);
                color: white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                margin-left: 5px;
            }
            
            /* Order Status Dropdown Styles */
            .status-dropdown {
                padding: 6px 10px;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 14px;
                cursor: pointer;
                transition: var(--transition);
                background-color: white;
                min-width: 120px;
            }

            .status-dropdown:hover {
                border-color: var(--secondary);
            }

            .status-dropdown:focus {
                outline: none;
                border-color: var(--secondary);
                box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            }

            /* Status-specific colors */
            .status-dropdown.pending {
                background-color: #fff3cd;
                color: #856404;
                border-color: #ffeaa7;
            }

            .status-dropdown.processing {
                background-color: #cce7ff;
                color: #004085;
                border-color: #b3d7ff;
            }

            .status-dropdown.completed {
                background-color: #d4edda;
                color: #155724;
                border-color: #c3e6cb;
            }

            .status-dropdown.cancelled {
                background-color: #f8d7da;
                color: #721c24;
                border-color: #f5c6cb;
            }

            .status-actions {
                display: flex;
                gap: 8px;
                align-items: center;
            }

            .update-status-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
            
            /* Modern Login Section */
            .login-section {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                background: var(--gradient);
                position: relative;
                overflow: hidden;
            }
            
            .login-section::before {
                content: '';
                position: absolute;
                width: 200%;
                height: 200%;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="rgba(255,255,255,0.1)"><circle cx="50" cy="50" r="2"/></svg>') repeat;
                animation: float 20s infinite linear;
            }
            
            @keyframes float {
                0% { transform: translate(0, 0) rotate(0deg); }
                100% { transform: translate(-50%, -50%) rotate(360deg); }
            }
            
            .login-container {
                max-width: 450px;
                width: 100%;
                margin: 50px auto;
                padding: 40px;
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                position: relative;
                overflow: hidden;
                backdrop-filter: blur(10px);
            }
            
            .login-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 5px;
                background: var(--gradient-accent);
            }
            
            .login-container h2 {
                text-align: center;
                margin-bottom: 20px;
                color: var(--primary);
            }
            
            .login-subtitle {
                text-align: center;
                margin-bottom: 30px;
                color: var(--gray);
            }
            
            .form-group {
                margin-bottom: 20px;
                position: relative;
            }
            
            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
            }
            
            .form-group input, .form-group select, .form-group textarea {
                width: 100%;
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                font-size: 16px;
                transition: var(--transition);
                background: rgba(255, 255, 255, 0.8);
            }
            
            .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
                outline: none;
                border-color: var(--secondary);
                box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            }
            
            .password-toggle {
                position: absolute;
                right: 15px;
                top: 43px;
                cursor: pointer;
                color: var(--gray);
                transition: var(--transition);
                z-index: 2;
            }
            
            .password-toggle:hover {
                color: var(--dark);
            }
            
            .password-requirements {
                margin-top: 10px;
                font-size: 14px;
                color: var(--gray);
            }
            
            .requirement {
                margin-bottom: 5px;
                display: flex;
                align-items: center;
            }
            
            .requirement i {
                margin-right: 5px;
                width: 16px;
            }
            
            .requirement.valid {
                color: var(--success);
            }
            
            .requirement.invalid {
                color: var(--danger);
            }
            
            .user-type-toggle {
                display: flex;
                margin-bottom: 20px;
                border-radius: var(--border-radius);
                overflow: hidden;
                border: 1px solid #ddd;
            }
            
            .user-type-toggle button {
                flex: 1;
                padding: 12px;
                background-color: #f8f9fa;
                border: none;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .user-type-toggle button.active {
                background: var(--gradient);
                color: white;
            }
            
            .form-footer {
                text-align: center;
                margin-top: 20px;
            }
            
            .form-footer a {
                color: var(--secondary);
                text-decoration: none;
                cursor: pointer;
                font-weight: 500;
            }
            
            .form-footer a:hover {
                text-decoration: underline;
            }
            
            .social-login {
                margin-top: 25px;
                border-top: 1px solid #eee;
                padding-top: 20px;
            }
            
            .social-login-title {
                text-align: center;
                margin-bottom: 15px;
                color: var(--gray);
                font-size: 14px;
            }
            
            .social-buttons {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .social-btn {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: var(--border-radius);
                color: white;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition);
            }
            
            .social-btn i {
                margin-right: 8px;
            }
            
            .social-btn.facebook {
                background-color: var(--facebook);
            }
            
            .social-btn.google {
                background-color: var(--google);
            }
            
            .social-btn.phone {
                background-color: var(--phone);
            }
            
            .social-btn:hover {
                opacity: 0.9;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            }
            
            /* Modern Dashboard Styles */
            .dashboard {
                padding: 30px 0;
            }
            
            .dashboard-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
            }
            
            .dashboard-title {
                font-size: 28px;
                color: var(--primary);
                position: relative;
                display: inline-block;
            }
            
            .dashboard-title::after {
                content: '';
                position: absolute;
                bottom: -5px;
                left: 0;
                width: 50%;
                height: 3px;
                background: var(--gradient-accent);
            }
            
            .stats-cards {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .stat-card {
                background-color: white;
                padding: 25px;
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                text-align: center;
                transition: var(--transition);
                position: relative;
                overflow: hidden;
            }
            
            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: var(--gradient);
            }
            
            .stat-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--hover-shadow);
            }
            
            .stat-card h3 {
                font-size: 14px;
                color: #7f8c8d;
                margin-bottom: 10px;
                text-transform: uppercase;
            }
            
            .stat-card .value {
                font-size: 32px;
                font-weight: 700;
                color: var(--primary);
            }
            
            .dashboard-section {
                background-color: white;
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                padding: 25px;
                margin-bottom: 30px;
                transition: var(--transition);
            }
            
            .dashboard-section:hover {
                box-shadow: var(--hover-shadow);
            }
            
            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 1px solid #eee;
            }
            
            .section-title {
                font-size: 22px;
                color: var(--primary);
                position: relative;
            }
            
            .section-title::after {
                content: '';
                position: absolute;
                bottom: -10px;
                left: 0;
                width: 40px;
                height: 3px;
                background: var(--gradient-accent);
            }
            
            /* Modern Table Styles */
            table {
                width: 100%;
                border-collapse: collapse;
            }
            
            table th, table td {
                padding: 12px 15px;
                text-align: left;
                border-bottom: 1px solid #eee;
            }
            
            table th {
                background-color: #f8f9fa;
                font-weight: 600;
                color: var(--primary);
            }
            
            table tr:hover {
                background-color: #f8f9fa;
            }
            
            /* Modern Modal Styles */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 1000;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
            }
            
            .modal.active {
                display: flex;
            }
            
            .modal-content {
                background-color: white;
                border-radius: var(--border-radius);
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                padding: 30px;
                position: relative;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                animation: modalFadeIn 0.3s ease-out;
            }
            
            @keyframes modalFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .modal-close {
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #7f8c8d;
                transition: var(--transition);
            }
            
            .modal-close:hover {
                color: var(--danger);
            }
            
            .modal-title {
                margin-bottom: 20px;
                color: var(--primary);
            }
            
            /* Modern Alert Styles */
            .alert {
                padding: 12px 15px;
                border-radius: var(--border-radius);
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                animation: slideIn 0.3s ease-out;
            }
            
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            
            .alert i {
                margin-right: 10px;
            }
            
            .alert-warning {
                background-color: #fff3cd;
                color: #856404;
                border: 1px solid #ffeaa7;
            }
            
            .alert-success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            
            /* Modern Product Grid */
            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 25px;
                margin-top: 20px;
            }
            
            .product-card {
                background-color: white;
                border-radius: var(--border-radius);
                overflow: hidden;
                box-shadow: var(--card-shadow);
                transition: var(--transition);
                position: relative;
            }
            
            .product-card:hover {
                transform: translateY(-10px);
                box-shadow: var(--hover-shadow);
            }
            
            .product-image {
                height: 200px;
                background-color: #f8f9fa;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #bdc3c7;
                position: relative;
                overflow: hidden;
            }
            
            .product-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.5s;
            }
            
            .product-card:hover .product-image img {
                transform: scale(1.1);
            }
            
            .product-badge {
                position: absolute;
                top: 10px;
                right: 10px;
                background: var(--gradient-accent);
                color: white;
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
                z-index: 1;
            }
            
            .product-info {
                padding: 20px;
            }
            
            .product-name {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 5px;
            }
            
            .product-category {
                font-size: 14px;
                color: var(--gray);
                margin-bottom: 10px;
            }
            
            .product-price {
                font-size: 20px;
                font-weight: 700;
                color: var(--accent);
                margin-bottom: 15px;
            }
            
            .product-actions {
                display: flex;
                gap: 10px;
            }
            
            .product-actions .btn {
                flex: 1;
            }
            
            /* Modern Cart Styles */
            .cart-item {
                display: flex;
                align-items: center;
                padding: 15px 0;
                border-bottom: 1px solid #eee;
            }
            
            .cart-item-image {
                width: 80px;
                height: 80px;
                background-color: #f8f9fa;
                margin-right: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #bdc3c7;
                overflow: hidden;
                border-radius: var(--border-radius);
            }
            
            .cart-item-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .cart-item-details {
                flex: 1;
            }
            
            .cart-item-name {
                font-weight: 600;
                margin-bottom: 5px;
            }
            
            .cart-item-price {
                color: var(--accent);
                font-weight: 600;
            }
            
            .cart-item-quantity {
                display: flex;
                align-items: center;
            }
            
            .quantity-btn {
                width: 30px;
                height: 30px;
                background-color: #f8f9fa;
                border: 1px solid #ddd;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .quantity-btn:hover {
                background-color: #e9ecef;
            }
            
            .quantity-input {
                width: 50px;
                height: 30px;
                text-align: center;
                border: 1px solid #ddd;
                margin: 0 5px;
            }
            
            .cart-total {
                margin-top: 20px;
                text-align: right;
                font-size: 20px;
                font-weight: 700;
            }
            
            /* Modern Tabs */
            .tabs {
                display: flex;
                border-bottom: 1px solid #ddd;
                margin-bottom: 20px;
            }
            
            .tab {
                padding: 12px 20px;
                cursor: pointer;
                border-bottom: 3px solid transparent;
                transition: var(--transition);
            }
            
            .tab.active {
                border-bottom-color: var(--secondary);
                color: var(--secondary);
                font-weight: 600;
            }
            
            .tab:hover:not(.active) {
                background-color: #f8f9fa;
            }
            
            .tab-content {
                display: none;
            }
            
            .tab-content.active {
                display: block;
            }
            
            /* Modern Home Page Styles */
            .hero-section {
                background: linear-gradient(rgba(44, 62, 80, 0.8), rgba(44, 62, 80, 0.8)), url('https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80');
                background-size: cover;
                background-position: center;
                color: white;
                padding: 100px 0;
                text-align: center;
                margin-bottom: 40px;
                position: relative;
                overflow: hidden;
            }
            
            .hero-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: var(--gradient);
                opacity: 0.7;
                z-index: 1;
            }
            
            .hero-section > .container {
                position: relative;
                z-index: 2;
            }
            
            .hero-title {
                font-size: 48px;
                margin-bottom: 20px;
                animation: fadeInUp 1s ease-out;
            }
            
            .hero-subtitle {
                font-size: 20px;
                margin-bottom: 30px;
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
                animation: fadeInUp 1s ease-out 0.2s both;
            }
            
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .featured-section {
                margin-bottom: 40px;
            }
            
            .promo-section {
                background: var(--gradient);
                color: white;
                padding: 40px 0;
                margin-bottom: 40px;
            }
            
            .promo-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
            
            .promo-card {
                background-color: rgba(255, 255, 255, 0.1);
                border-radius: var(--border-radius);
                padding: 25px;
                text-align: center;
                transition: var(--transition);
                backdrop-filter: blur(10px);
            }
            
            .promo-card:hover {
                transform: translateY(-5px);
                background-color: rgba(255, 255, 255, 0.15);
            }
            
            .promo-card h3 {
                margin-bottom: 10px;
                font-size: 24px;
            }
            
            .promo-card p {
                margin-bottom: 15px;
            }
            
            .new-products-section {
                margin-bottom: 40px;
            }
            
            .recent-search-section {
                margin-bottom: 40px;
            }
            
            .search-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 15px;
            }
            
            .search-tag {
                background-color: var(--light);
                padding: 8px 15px;
                border-radius: 20px;
                cursor: pointer;
                transition: var(--transition);
            }
            
            .search-tag:hover {
                background: var(--gradient);
                color: white;
            }
            
            /* Modern Product Detail Modal */
            .product-detail-modal .modal-content {
                max-width: 900px;
            }
            
            .product-detail {
                display: flex;
                gap: 30px;
            }
            
            .product-detail-image {
                flex: 1;
                max-width: 400px;
            }
            
            .product-detail-image img {
                width: 100%;
                border-radius: var(--border-radius);
            }
            
            .product-detail-info {
                flex: 1;
            }
            
            .product-detail-name {
                font-size: 28px;
                margin-bottom: 10px;
                color: var(--primary);
            }
            
            .product-detail-price {
                font-size: 24px;
                color: var(--accent);
                margin-bottom: 15px;
            }
            
            .product-detail-description {
                margin-bottom: 20px;
                line-height: 1.6;
            }
            
            .product-detail-specs {
                margin-bottom: 20px;
            }
            
            .product-detail-specs h4 {
                margin-bottom: 10px;
                color: var(--primary);
            }
            
            .product-detail-actions {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
            
            /* Enhanced Profile Styles */
            .profile-section {
                padding: 20px;
            }
            
            .profile-header {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid #eee;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
                border-radius: 50%;
                background: var(--gradient);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 32px;
                margin-right: 20px;
                flex-shrink: 0;
            }
            
            .profile-info h2 {
                margin-bottom: 5px;
                color: var(--primary);
            }
            
            .profile-info p {
                color: var(--gray);
                margin-bottom: 3px;
            }
            
            .profile-stats {
                display: flex;
                gap: 20px;
                margin-top: 10px;
            }
            
            .profile-stat {
                text-align: center;
            }
            
            .profile-stat-value {
                font-weight: 700;
                font-size: 18px;
                color: var(--primary);
            }
            
            .profile-stat-label {
                font-size: 12px;
                color: var(--gray);
            }
            
            .profile-tabs {
                display: flex;
                margin-bottom: 20px;
                border-bottom: 1px solid #eee;
                overflow-x: auto;
            }
            
            .profile-tab {
                padding: 12px 20px;
                cursor: pointer;
                border-bottom: 3px solid transparent;
                white-space: nowrap;
                transition: var(--transition);
            }
            
            .profile-tab.active {
                border-bottom-color: var(--secondary);
                color: var(--secondary);
                font-weight: 600;
            }
            
            .profile-tab:hover:not(.active) {
                background-color: #f8f9fa;
            }
            
            .profile-tab-content {
                display: none;
                animation: fadeIn 0.3s ease;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            .profile-tab-content.active {
                display: block;
            }
            
            .profile-form {
                max-width: 500px;
            }
            
            .profile-actions {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
            
            .order-history {
                width: 100%;
            }
            
            .order-card {
                background-color: white;
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                margin-bottom: 15px;
                overflow: hidden;
                transition: var(--transition);
            }
            
            .order-card:hover {
                box-shadow: var(--hover-shadow);
            }
            
            .order-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px 20px;
                background-color: #f8f9fa;
                border-bottom: 1px solid #eee;
            }
            
            .order-id {
                font-weight: 600;
                color: var(--primary);
            }
            
            .order-date {
                color: var(--gray);
                font-size: 14px;
            }
            
            .order-status {
                padding: 5px 10px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }
            
            .order-status.pending {
                background-color: #fff3cd;
                color: #856404;
            }
            
            .order-status.processing {
                background-color: #cce7ff;
                color: #004085;
            }
            
            .order-status.completed {
                background-color: #d4edda;
                color: #155724;
            }
            
            .order-status.cancelled {
                background-color: #f8d7da;
                color: #721c24;
            }
            
            .order-details {
                padding: 20px;
            }
            
            .order-items {
                margin-bottom: 15px;
            }
            
            .order-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #f0f0f0;
            }
            
            .order-item:last-child {
                border-bottom: none;
            }
            
            .order-item-name {
                flex: 1;
            }
            
            .order-item-quantity {
                margin: 0 15px;
                color: var(--gray);
            }
            
            .order-item-price {
                font-weight: 600;
            }
            
            .order-total {
                display: flex;
                justify-content: space-between;
                font-weight: 700;
                font-size: 18px;
                padding-top: 15px;
                border-top: 2px solid #eee;
            }
            
            .order-actions {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }
            
            .empty-state {
                text-align: center;
                padding: 40px 20px;
                color: var(--gray);
            }
            
            .empty-state i {
                font-size: 64px;
                margin-bottom: 20px;
                color: #e0e0e0;
            }
            
            .empty-state h3 {
                margin-bottom: 10px;
                color: var(--dark);
            }
            
            .empty-state p {
                margin-bottom: 20px;
            }
            
            .security-settings {
                margin-top: 20px;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }
            
            .security-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px 0;
                border-bottom: 1px solid #f5f5f5;
            }
            
            .security-item:last-child {
                border-bottom: none;
            }
            
            .security-info h4 {
                margin-bottom: 5px;
                color: var(--primary);
            }
            
            .security-info p {
                color: var(--gray);
                font-size: 14px;
            }
            
            .last-updated {
                font-size: 12px;
                color: var(--gray);
                margin-top: 5px;
            }
            
            /* Modern Support Chat */
            .support-widget {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--gradient);
                color: white;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                z-index: 100;
                transition: var(--transition);
            }
            
            .support-widget:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            }
            
            .support-chat {
                position: fixed;
                bottom: 90px;
                right: 20px;
                width: 350px;
                height: 450px;
                background-color: white;
                border-radius: var(--border-radius);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                display: none;
                flex-direction: column;
                z-index: 100;
                animation: chatFadeIn 0.3s ease-out;
            }
            
            @keyframes chatFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .support-chat.active {
                display: flex;
            }
            
            .chat-header {
                background: var(--gradient);
                color: white;
                padding: 15px;
                border-radius: var(--border-radius) var(--border-radius) 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .chat-messages {
                flex: 1;
                padding: 15px;
                overflow-y: auto;
            }
            
            .message {
                margin-bottom: 15px;
                padding: 10px 15px;
                border-radius: 18px;
                max-width: 80%;
                animation: messageFadeIn 0.3s ease-out;
            }
            
            @keyframes messageFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .message.user {
                background-color: #e3f2fd;
                margin-left: auto;
                border-bottom-right-radius: 4px;
            }
            
            .message.support {
                background-color: #f5f5f5;
                border-bottom-left-radius: 4px;
            }
            
            .chat-input {
                display: flex;
                padding: 15px;
                border-top: 1px solid #eee;
            }
            
            .chat-input input {
                flex: 1;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 20px;
                margin-right: 10px;
            }
            
            /* Modern Search & Filter */
            .search-filter {
                display: flex;
                align-items: center;
                gap: 12px;
            }
            
            .search-box {
                position: relative;
                display: flex;
                align-items: center;
                background: #fff;
                border: 1.5px solid #ddd;
                border-radius: 30px;
                padding: 8px 15px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                transition: var(--transition);
            }
            
            .search-box:focus-within {
                border-color: var(--secondary);
                box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            }
            
            #product-search, #inventory-search {
                border: none;
                outline: none;
                background: none;
                font-size: 15px;
                color: #333;
                width: 200px;
                transition: width 0.3s ease;
            }
            
            #product-search:focus, #inventory-search:focus {
                width: 250px;
            }
            
            .search-icon {
                color: #666;
                font-size: 16px;
                cursor: pointer;
                transition: color 0.2s ease;
            }
            
            .search-icon:hover {
                color: var(--secondary);
            }
            
            #category-filter, #order-filter, #transaction-filter, #report-period {
                padding: 10px 14px;
                border: 1.5px solid #ccc;
                border-radius: 10px;
                background-color: #fff;
                color: #333;
                font-size: 15px;
                font-weight: 500;
                outline: none;
                transition: var(--transition);
                cursor: pointer;
                appearance: none;
                background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
                background-repeat: no-repeat;
                background-position: right 12px center;
                background-size: 16px;
                padding-right: 40px;
            }
            
            #category-filter:hover, #order-filter:hover, #transaction-filter:hover, #report-period:hover {
                border-color: #888;
            }
            
            #category-filter:focus, #order-filter:focus, #transaction-filter:focus, #report-period:focus {
                border-color: var(--secondary);
                box-shadow: 0 0 6px rgba(74, 144, 226, 0.4);
            }
            /* Sort dropdown styles */
            
    #sort-price {
    padding: 10px 14px;
    border: 1.5px solid #ccc;
    border-radius: 10px;
    background-color: #fff;
    color: #333;
    font-size: 15px;
    font-weight: 500;
    outline: none;
    transition: var(--transition);
    cursor: pointer;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
    padding-right: 40px;
}

#sort-price:hover {
    border-color: #888;
}

#sort-price:focus {
    border-color: var(--secondary);
    box-shadow: 0 0 6px rgba(74, 144, 226, 0.4);
}

/* Responsive adjustments for search-filter */
@media (max-width: 768px) {
    .search-filter {
        flex-direction: column;
        width: 100%;
    }
    
    #product-search, #category-filter, #sort-price {
        width: 100%;
        margin-bottom: 10px;
    }
}
            
            /* Modern Toggle Switches */
            .toggle-group {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 15px;
                padding: 12px 18px;
                background: #fff;
                border: 1.5px solid #ddd;
                border-radius: 12px;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            }
            
            .toggle-group label:first-child {
                font-weight: 600;
                color: #333;
                font-size: 15px;
            }
            
            .switch {
                position: relative;
                display: inline-block;
                width: 46px;
                height: 26px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: var(--transition);
                border-radius: 34px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: var(--transition);
                border-radius: 50%;
            }
            
            .switch input:checked + .slider {
                background: var(--gradient);
            }
            
            .switch input:checked + .slider:before {
                transform: translateX(20px);
            }
            
            .switch input:focus + .slider {
                box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
            }
            
            /* Modern Report Section */
            .report-period-selector {
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 20px 0;
            }
            
            .report-content {
                background-color: #f8f9fa;
                padding: 20px;
                border-radius: var(--border-radius);
            }
            
            .report-summary {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .report-summary-item {
                background-color: white;
                padding: 15px;
                border-radius: var(--border-radius);
                text-align: center;
                box-shadow: var(--card-shadow);
            }
            
            .report-summary-item .value {
                font-size: 24px;
                font-weight: 700;
                color: var(--primary);
            }
            
            .report-summary-item .label {
                font-size: 14px;
                color: var(--gray);
                margin-top: 5px;
            }
            
            /* Enhanced Checkout Styles */
            .checkout-container {
                display: flex;
                flex-wrap: wrap;
                gap: 30px;
            }
            
            .checkout-form, .order-summary {
                flex: 1;
                min-width: 300px;
                background: white;
                border-radius: var(--border-radius);
                box-shadow: var(--card-shadow);
                padding: 25px;
            }
            
            .checkout-form .section-title {
                font-size: 1.4rem;
                color: var(--primary);
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid var(--light);
            }
            
            .address-group {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .payment-methods {
                margin-top: 25px;
            }
            
            .payment-options {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            
            .payment-option {
                display: flex;
                align-items: center;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: var(--border-radius);
                cursor: pointer;
                transition: var(--transition);
            }
            
            .payment-option:hover {
                border-color: var(--secondary);
                background-color: rgba(52, 152, 219, 0.05);
            }
            
            .payment-option.selected {
                border-color: var(--secondary);
                background-color: rgba(52, 152, 219, 0.1);
            }
            
            .payment-option input {
                width: auto;
                margin-right: 10px;
            }
            
            .payment-icon {
                width: 40px;
                height: 40px;
                margin-right: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: var(--light);
                border-radius: 50%;
                font-weight: bold;
                color: var(--primary);
            }
            
            .payment-details {
                margin-top: 15px;
                padding: 15px;
                background-color: var(--light);
                border-radius: var(--border-radius);
                display: none;
            }
            
            .payment-details.active {
                display: block;
            }
            
            .order-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 15px 0;
                border-bottom: 1px solid #eee;
            }
            
            .order-item:last-child {
                border-bottom: none;
            }
            
            .item-details h3 {
                font-size: 1.1rem;
                margin-bottom: 5px;
            }
            
            .item-price {
                font-weight: bold;
                font-size: 1.2rem;
            }
            
            .order-total {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 20px;
                padding-top: 20px;
                border-top: 2px solid var(--light);
                font-size: 1.3rem;
                font-weight: bold;
            }
            
            .total-amount {
                color: var(--accent);
                font-size: 1.5rem;
            }
            
            .checkout-btn {
                width: 100%;
                padding: 15px;
                background-color: var(--success);
                color: white;
                border: none;
                border-radius: var(--border-radius);
                font-size: 1.1rem;
                font-weight: bold;
                cursor: pointer;
                transition: var(--transition);
                margin-top: 25px;
            }
            
            .checkout-btn:hover {
                background-color: #219653;
            }
            
            /* Currency symbol */
            .currency {
                font-family: Arial, sans-serif;
            }
            
            /* Hidden admin access button */
            /* Modern Toast notifications */
            /* Modern Toast notifications - Updated for top position */
            .toast {
                position: fixed;
                top: -100px; /* Start off-screen at the top */
                left: 50%;
                transform: translateX(-50%);
                background-color: var(--primary);
                color: white;
                padding: 15px 25px;
                border-radius: var(--border-radius);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 10px;
                transition: top 0.3s ease-out, opacity 0.3s ease-out;
                opacity: 0;
                max-width: 90%;
                text-align: center;
            }

            .toast.show {
                top: 20px; /* Slide down to visible position */
                opacity: 1;
            }
            
            .toast.success {
                background: var(--success);
            }

            .toast.error {
                background: var(--danger);
            }

            .toast.warning {
                background: var(--warning);
            }

            .toast.info {
                background: var(--secondary);
            }

            /* Toast icon styles */
            .toast i {
                font-size: 20px;
            }

            /* Enhanced Wishlist Styles */
            .wishlist-item {
                display: flex;
                align-items: center;
                padding: 20px;
                border-bottom: 1px solid #eee;
                transition: var(--transition);
                border-radius: var(--border-radius);
            }
            
            .wishlist-item:hover {
                background-color: #f8f9fa;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            }
            
            .wishlist-item-image {
                width: 100px;
                height: 100px;
                background-color: #f8f9fa;
                margin-right: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #bdc3c7;
                overflow: hidden;
                border-radius: var(--border-radius);
                flex-shrink: 0;
            }
            
            .wishlist-item-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .wishlist-item-details {
                flex: 1;
            }
            
            .wishlist-item-name {
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 18px;
            }
            
            .wishlist-item-price {
                color: var(--accent);
                font-weight: 600;
                font-size: 18px;
            }
            
            .wishlist-item-actions {
                display: flex;
                gap: 10px;
            }
            
            .wishlist-empty {
                text-align: center;
                padding: 40px 20px;
                color: var(--gray);
            }
            
            .wishlist-empty i {
                font-size: 64px;
                margin-bottom: 20px;
                color: #e0e0e0;
            }
            
            .wishlist-empty h3 {
                margin-bottom: 10px;
                color: var(--dark);
            }
            
            .wishlist-empty p {
                margin-bottom: 20px;
            }
            
            /* Responsive Design */
            @media (max-width: 768px) {
                .header-content {
                    flex-direction: column;
                }
                
                nav ul {
                    margin-top: 15px;
                    flex-wrap: wrap;
                    justify-content: center;
                }
                
                nav ul li {
                    margin: 5px;
                }
                
                .dashboard-header {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                .dashboard-header .btn {
                    margin-top: 15px;
                }
                
                .section-header {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                .section-header > div {
                    margin-top: 10px;
                    width: 100%;
                }
                
                .social-buttons {
                    flex-direction: column;
                }
                
                .checkout-container {
                    flex-direction: column;
                }
                
                .hero-title {
                    font-size: 36px;
                }
                
                .hero-subtitle {
                    font-size: 18px;
                }
                
                .product-detail {
                    flex-direction: column;
                }
                
                .product-detail-image {
                    max-width: 100%;
                }
                
                .search-filter {
                    flex-direction: column;
                    width: 100%;
                }
                
                #product-search, #category-filter {
                    width: 100%;
                }
                
                .wishlist-item {
                    flex-direction: column;
                    text-align: center;
                }
                
                .wishlist-item-image {
                    margin-right: 0;
                    margin-bottom: 15px;
                }
                
                .wishlist-item-actions {
                    justify-content: center;
                    margin-top: 15px;
                }
                
                /* Responsive adjustments for profile */
                .profile-header {
                    flex-direction: column;
                    text-align: center;
                }
                
                .profile-avatar {
                    margin-right: 0;
                    margin-bottom: 15px;
                }
                
                .profile-stats {
                    justify-content: center;
                }
                
                .profile-tabs {
                    flex-wrap: nowrap;
                    overflow-x: auto;
                }
                
                .order-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 10px;
                }
                
                .order-status {
                    align-self: flex-start;
                }
                
                /* Responsive adjustments for checkout */
                .address-group {
                    grid-template-columns: 1fr;
                }
            }


        </style>
    </head>
    <body>
        <!-- Toast Notification -->
        <div id="toast" class="toast hidden"></div>

        <!-- Header -->
        <header>
            <div class="container header-content">
                <a href="#" class="logo">
                    <i class="fas fa-couch"></i>
                    Furniture<span>Haven</span>
                </a>
                <nav>
                    <ul>
                        <!-- Show these items only for customers -->
                        <li class="customer-nav"><a href="#" id="nav-home"><i class="fas fa-home"></i> Home</a></li>
                        <li class="customer-nav"><a href="#" id="nav-products"><i class="fas fa-couch"></i> Products</a></li>
                        <li class="customer-nav"><a href="#" id="nav-cart"><i class="fas fa-shopping-cart"></i> Cart <span class="cart-badge" id="cart-count">0</span></a></li>
                        <li class="customer-nav"><a href="#" id="nav-wishlist"><i class="fas fa-heart"></i> Wishlist</a></li>
                        <li class="customer-nav"><a href="#" id="nav-orders"><i class="fas fa-clipboard-list"></i> Orders</a></li>
                        
                        <!-- Profile with logo for both customer and admin -->
                        <li><a href="#" id="nav-profile" class="profile-logo">
                            <i class="fas fa-user-circle"></i>
                        </a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Login Section -->
        <section id="login-section" class="login-section">
            <div class="container">
                <div class="login-container">
                    <h2>Welcome to Furniture Haven</h2>
                    <p class="login-subtitle">Please select your login type</p>
                    
                    <div class="user-type-toggle">
                        <button id="customer-toggle" class="active">Customer</button>
                        <button id="admin-toggle">Admin</button>
                    </div>
                    
                    <!-- Customer Login Form -->
                    <div id="customer-login-form">
                        <form id="login-form">
                            <div class="form-group">
                                <label for="username">Username or Email</label>
                                <input type="text" id="username" required>
                            </div>
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" required>
                                <span class="password-toggle" id="toggle-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                        </form>
                        
                        <div class="form-footer">
                            <a id="switch-to-signup">Don't have an account? Sign up</a>
                        </div>
                        
                        <div class="social-login">
                            <div class="social-login-title">Or sign in with</div>
                            <div class="social-buttons">
                                <button class="social-btn google" id="google-login">
                                    <i class="fab fa-google"></i> Google
                                </button>
                                <button class="social-btn facebook" id="facebook-login">
                                    <i class="fab fa-facebook-f"></i> Facebook
                                </button>
                                <button class="social-btn phone" id="phone-login">
                                    <i class="fas fa-phone"></i> Phone
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customer Signup Form -->
                    <div id="customer-signup-form" class="hidden">
                        <form id="signup-form">
                            <div class="form-group">
                                <label for="signup-name">Full Name</label>
                                <input type="text" id="signup-name" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-email">Email</label>
                                <input type="email" id="signup-email" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-username">Username</label>
                                <input type="text" id="signup-username" required>
                            </div>
                            <div class="form-group">
                                <label for="signup-password">Password</label>
                                <input type="password" id="signup-password" required>
                                <span class="password-toggle" id="toggle-signup-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                                <div class="password-requirements" id="password-requirements">
                                    <div class="requirement" id="req-length">
                                        <i class="fas fa-times"></i>
                                        At least 8 characters
                                    </div>
                                    <div class="requirement" id="req-lowercase">
                                        <i class="fas fa-times"></i>
                                        One lowercase letter 
                                    </div>
                                    <div class="requirement" id="req-uppercase">
                                        <i class="fas fa-times"></i>
                                        One uppercase letter 
                                    </div>
                                    <div class="requirement" id="req-digit">
                                        <i class="fas fa-times"></i>
                                        One digit 
                                    </div>
                                    <div class="requirement" id="req-special">
                                        <i class="fas fa-times"></i>
                                        One special character 
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="signup-confirm-password">Confirm Password</label>
                                <input type="password" id="signup-confirm-password" required>
                                <span class="password-toggle" id="toggle-confirm-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <button type="submit" class="btn btn-success" style="width: 100%;" id="signup-btn" disabled>Create Account</button>
                        </form>
                        
                        <div class="form-footer">
                            <a id="switch-to-login">Already have an account? Login</a>
                        </div>
                    </div>
                    
                    <!-- Admin Login Form -->
                    <div id="admin-login-form" class="hidden">
                        <form id="admin-form">
                            <div class="form-group">
                                <label for="admin-username">Admin Username</label>
                                <input type="text" id="admin-username" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-password">Admin Password</label>
                                <input type="password" id="admin-password" required>
                                <span class="password-toggle" id="toggle-admin-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Admin Login</button>
                        </form>
                        
                        <div class="form-footer">
                            <p>Admin access is restricted to authorized personnel only.</p>
                        </div>
                    </div>
                    
                    <div id="login-message" style="margin-top: 15px; text-align: center;"></div>
                </div>
            </div>
        </section>

        <!-- Home Page -->
        <section id="home-page" class="dashboard hidden">
            <div class="hero-section">
                <div class="container">
                    <h1 class="hero-title">Transform Your Space with Style</h1>
                    <p class="hero-subtitle">Discover premium furniture that combines comfort, quality, and design to create the perfect atmosphere in your home or office.</p>
                    <button class="btn btn-primary" id="shop-now-btn">Shop Now</button>
                </div>
            </div>

            <div class="container">
                <!-- Featured Furniture Section -->
                <div class="featured-section">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Featured Furniture</h2>
                            <a href="#" id="view-all-featured">View All</a>
                        </div>
                        <div class="product-grid" id="featured-products">
                            <!-- Featured products will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Promotions Section -->
                <div class="promo-section">
                    <div class="container">
                        <h2 class="section-title" style="color: white; text-align: center; margin-bottom: 30px;">Special Promotions</h2>
                        <div class="promo-grid">
                            <div class="promo-card">
                                <h3>Summer Sale</h3>
                                <p>Up to 30% off on all outdoor furniture</p>
                                <button class="btn btn-warning">Shop Now</button>
                            </div>
                            <div class="promo-card">
                                <h3>New Arrivals</h3>
                                <p>Fresh designs just added to our collection</p>
                                <button class="btn btn-warning">Explore</button>
                            </div>
                            <div class="promo-card">
                                <h3>Free Shipping</h3>
                                <p>On all orders over <span class="currency"></span>5000</p>
                                <button class="btn btn-warning">Learn More</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Newest Products Section -->
                <div class="new-products-section">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Newest Arrivals</h2>
                            <a href="#" id="view-all-new">View All</a>
                        </div>
                        <div class="product-grid" id="new-products">
                            <!-- New products will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Recent Search Section -->
                <div class="recent-search-section">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Recent Searches</h2>
                            <a href="#" id="clear-searches">Clear All</a>
                        </div>
                        <div class="search-tags" id="recent-searches">
                            <!-- Recent searches will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customer Dashboard -->
        <section id="customer-dashboard" class="dashboard hidden">
            <div class="container">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Welcome to Furniture Haven</h1>
                    <div>
                        <button class="btn btn-primary" id="view-cart-btn">View Cart</button>
                        <button class="btn btn-success" id="view-wishlist-btn">Wishlist</button>
                    </div>
                </div>

                <div class="dashboard-section">
                    <div class="section-header">
                        <h2 class="section-title">Our Furniture Collection</h2>
                        <div class="search-filter">
                            <!-- Search box with icon -->
                            <div class="search-box">
                                <input type="text" id="product-search" placeholder="Search products...">
                                <i class="fas fa-search search-icon"></i>
                            </div>

                            <!-- Category dropdown -->
                            <select id="category-filter">
                                <option value="all">All Categories</option>
                                <option value="sofa">Sofas</option>
                                <option value="single-sofa">Single Sofas</option>
                                <option value="gaming-chair">Gaming Chairs</option>
                                <option value="gaming-table">Gaming Tables</option>
                                <option value="dining-table">Dining Tables</option>
                                <option value="coffee-table">Coffee Tables</option>
                                <option value="shoe-rack">Shoe Racks</option>
                                <option value="dresser">Dressers</option>
                                <option value="shelf">Shelves</option>
                                <option value="wall-shelf">Wall Shelves</option>
                                <option value="lamp">Lamps</option>
                            </select>
                            <!-- Add this next to the category dropdown in the search-filter div -->
                            <select id="sort-price">
                                <option value="default">Sort by</option>
                                <option value="asc">Price: Low to High</option>
                            <option value="desc">Price: High to Low</option>
                            </select>
                           
    
                        </div>
                    </div>
                    <div class="product-grid" id="product-grid">
                        <!-- Products will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <section id="admin-dashboard" class="dashboard hidden">
            <div class="container">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Admin Dashboard</h1>
                    <div>
                        <button class="btn btn-primary" id="add-product-btn">Add New Product</button>
                        <button class="btn btn-success" id="generate-report-btn">Generate Report</button>
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <div class="value" id="total-products">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Low Stock Items</h3>
                        <div class="value" id="low-stock-count">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Sales</h3>
                        <div class="value"><span class="currency"></span><span id="total-sales">0</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Orders</h3>
                        <div class="value" id="pending-orders">0</div>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="inventory">Inventory Management</div>
                    <div class="tab" data-tab="orders">Order Management</div>
                    <div class="tab" data-tab="transactions">Transaction Logs</div>
                    <div class="tab" data-tab="fifo">FIFO Settings</div>
                    <div class="tab" data-tab="alerts">Alert Settings</div>
                    <div class="tab" data-tab="reports">Reports</div>
                </div>

                <!-- Inventory Management Tab -->
                <div class="tab-content active" id="inventory-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Product Inventory</h2>
                            <div class="search-filter">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="inventory-search" placeholder="Search products...">
                                </div>
                                <button class="btn btn-primary" id="export-inventory-btn">Export Inventory</button>
                            </div>
                        </div>
                        <div id="inventory-alerts"></div>
                        <table id="inventory-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Product Name</th>
                                    <th>Category</th>
                                    <th>Stock</th>
                                    <th>Dimensions</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Inventory data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Order Management Tab -->
                <div class="tab-content" id="orders-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Order Management</h2>
                            <div>
                                <select id="order-filter">
                                    <option value="all">All Orders</option>
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <button class="btn btn-primary" id="export-orders-btn">Export Orders</button>
                            </div>
                        </div>
                        <table id="orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Items</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Orders data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Transaction Logs Tab -->
                <div class="tab-content" id="transactions-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Transaction Logs</h2>
                            <div>
                                <select id="transaction-filter">
                                    <option value="all">All Transactions</option>
                                    <option value="purchase">Purchases</option>
                                    <option value="sale">Sales</option>
                                    <option value="restock">Restocks</option>
                                </select>
                                <button class="btn btn-primary" id="export-transactions-btn">Export Transactions</button>
                            </div>
                        </div>
                        <div class="admin-log-section">
                            <div class="admin-log-content" id="transaction-logs">
                                <!-- Transaction logs will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FIFO Settings Tab -->
                <div class="tab-content" id="fifo-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">FIFO (First-In, First-Out) Settings</h2>
                        </div>
                        <div class="form-group toggle-group">
                            <label for="fifo-toggle">Enable FIFO Inventory Management</label>
                            <label class="switch">
                                <input type="checkbox" id="fifo-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="fifo-description">FIFO Description</label>
                            <textarea id="fifo-description" rows="3" readonly>First-In, First-Out (FIFO) ensures that the oldest inventory items (first in) are sold first (first out). This is especially important for furniture items with batch arrivals to prevent aging inventory.</textarea>
                        </div>
                        <div class="admin-batch-section">
                            <div class="admin-batch-header">
                                <h3 class="admin-batch-title">Current Inventory Batches</h3>
                                <button class="btn btn-primary btn-sm" id="add-batch-btn">Add Batch</button>
                            </div>
                            <table class="admin-batch-table" id="batch-table">
                                <thead>
                                    <tr>
                                        <th>Batch ID</th>
                                        <th>Product</th>
                                        <th>Arrival Date</th>
                                        <th>Quantity</th>
                                        <th>Remaining</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Batch data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Alert Settings Tab -->
                <div class="tab-content" id="alerts-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Low Stock Alert Settings</h2>
                        </div>
                        <div class="form-group">
                            <label for="global-threshold">Global Low Stock Threshold</label>
                            <input type="number" id="global-threshold" value="10" min="1">
                            <small>This threshold will apply to all products unless overridden by product-specific settings.</small>
                        </div>
                        <div class="settings-section">
                            <div class="form-group toggle-group">
                                <label for="fifo-toggle">Enable FIFO Inventory Management</label>
                                <label class="switch">
                                    <input type="checkbox" id="fifo-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="form-group toggle-group">
                                <label for="email-alerts-toggle">Enable Email Alerts for Low Stock</label>
                                <label class="switch">
                                    <input type="checkbox" id="email-alerts-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="form-group toggle-group">
                                <label for="dashboard-alerts-toggle">Show Low Stock Alerts on Dashboard</label>
                                <label class="switch">
                                    <input type="checkbox" id="dashboard-alerts-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="save-alert-settings-btn">Save Alert Settings</button>
                        <div class="admin-batch-section">
                            <div class="admin-batch-header">
                                <h3 class="admin-batch-title">Product-Specific Thresholds</h3>
                                <button class="btn btn-primary btn-sm" id="add-threshold-btn">Add Threshold</button>
                            </div>
                            <table class="admin-batch-table" id="threshold-table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Current Stock</th>
                                        <th>Threshold</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Threshold data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-content" id="reports-tab">
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2 class="section-title">Reports & Analytics</h2>
                            <div>
                                <button class="btn btn-primary" id="export-reports-btn">Export All Reports</button>
                            </div>
                        </div>
                        
                        <div class="report-period-selector">
                            <select id="report-period">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <input type="date" id="report-start-date" class="hidden">
                            <input type="date" id="report-end-date" class="hidden">
                            <button class="btn btn-primary" id="generate-report-period-btn">Generate Report</button>
                        </div>
                        
                        <div class="report-content">
                            <div class="report-summary">
                                <div class="report-summary-item">
                                    <div class="value"><span class="currency"></span><span id="report-total-sales">0</span></div>
                                    <div class="label">Total Sales</div>
                                </div>
                                <div class="report-summary-item">
                                    <div class="value" id="report-total-orders">0</div>
                                    <div class="label">Total Orders</div>
                                </div>
                                <div class="report-summary-item">
                                    <div class="value" id="report-low-stock">0</div>
                                    <div class="label">Low Stock Items</div>
                                </div>
                                <div class="report-summary-item">
                                    <div class="value" id="report-top-category">-</div>
                                    <div class="label">Top Category</div>
                                </div>
                            </div>
                            
                            <div id="report-details">
                                <!-- Report details will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product Form Modal -->
        <div class="modal" id="product-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-product-modal">&times;</button>
                <h2 class="modal-title" id="product-modal-title">Add New Product</h2>
                <form id="product-form">
                    <div class="form-group">
                        <label for="product-name">Product Name</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="product-category">Category</label>
                        <select id="product-category" required>
                            <option value="sofa">Sofa</option>
                            <option value="single-sofa">Single Sofa</option>
                            <option value="gaming-chair">Gaming Chair</option>
                            <option value="gaming-table">Gaming Table</option>
                            <option value="dining-table">Dining Table</option>
                            <option value="coffee-table">Coffee Table</option>
                            <option value="shoe-rack">Shoe Rack</option>
                            <option value="dresser">Dresser</option>
                            <option value="shelf">Shelf</option>
                            <option value="wall-shelf">Wall Shelf</option>
                            <option value="lamp">Lamp</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="product-price">Price (<span class="currency"></span>)</label>
                        <input type="number" id="product-price" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="product-stock">Stock Quantity</label>
                        <input type="number" id="product-stock" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="product-dimensions">Dimensions (W x H x D)</label>
                        <input type="text" id="product-dimensions" placeholder="e.g., 80x40x30">
                    </div>
                    <div class="form-group">
                        <label for="product-description">Description</label>
                        <textarea id="product-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="product-image">Image URL</label>
                        <input type="text" id="product-image" placeholder="Enter image URL">
                    </div>
                    <div class="form-group">
                        <label for="product-threshold">Low Stock Threshold (leave empty for global setting)</label>
                        <input type="number" id="product-threshold" min="1">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </form>
            </div>
        </div>

        <!-- Product Detail Modal -->
        <div class="modal product-detail-modal" id="product-detail-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-product-detail-modal">&times;</button>
                <div class="product-detail" id="product-detail-content">
                    <!-- Product details will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Stock Update Modal -->
        <div class="modal" id="stock-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-stock-modal">&times;</button>
                <h2 class="modal-title">Update Stock</h2>
                <form id="stock-form">
                    <div class="form-group">
                        <label for="stock-product">Product</label>
                        <input type="text" id="stock-product" readonly>
                    </div>
                    <div class="form-group">
                        <label for="stock-action">Action</label>
                        <select id="stock-action" required>
                            <option value="restock">Restock</option>
                            <option value="adjust">Adjust Quantity</option>
                            <option value="set">Set Quantity</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stock-quantity">Quantity</label>
                        <input type="number" id="stock-quantity" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="stock-reason">Reason</label>
                        <input type="text" id="stock-reason" placeholder="e.g., New shipment, Damaged items">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Stock</button>
                </form>
            </div>
        </div>

        <!-- Cart Modal -->
        <div class="modal" id="cart-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-cart-modal">&times;</button>
                <h2 class="modal-title">Your Shopping Cart</h2>
                <div id="cart-items">
                    <!-- Cart items will be populated by JavaScript -->
                </div>
                <div class="cart-total">
                    Total: <span class="currency"></span><span id="cart-total-amount">0.00</span>
                </div>
                <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                    <button class="btn btn-primary" id="continue-shopping-btn">Continue Shopping</button>
                    <button class="btn btn-success" id="checkout-btn">Checkout</button>
                </div>
            </div>
        </div>

        <!-- Wishlist Modal -->
        <div class="modal" id="wishlist-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-wishlist-modal">&times;</button>
                <h2 class="modal-title">Your Wishlist</h2>
                <div id="wishlist-items">
                    <!-- Wishlist items will be populated by JavaScript -->
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-primary" id="close-wishlist-btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Enhanced Checkout Modal -->
        <div class="modal" id="checkout-modal">
            <div class="modal-content" style="max-width: 1000px;">
                <button class="modal-close" id="close-checkout-modal">&times;</button>
                <h2 class="modal-title">Checkout</h2>
                <div class="checkout-container">
                    <div class="checkout-form">
                        <h2 class="section-title">Shipping Information</h2>
                        
                        <form id="checkout-form">
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" placeholder="Enter your full name">
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" placeholder="Enter your email">
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" placeholder="Enter your phone number">
                            </div>
                            
                            <div class="form-group">
                                <label for="address">Street Address</label>
                                <input type="text" id="address" placeholder="Enter your street address">
                            </div>
                            
                            <div class="address-group">
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" placeholder="Enter your city">
                                </div>
                                
                                <div class="form-group">
                                    <label for="state">State/Province</label>
                                    <input type="text" id="state" placeholder="Enter your state">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="zipCode">ZIP/Postal Code</label>
                                <input type="text" id="zipCode" placeholder="Enter your ZIP code">
                            </div>
                            
                            <div class="payment-methods">
                                <h2 class="section-title">Payment Method</h2>
                                
                                <div class="payment-options">
                                    <div class="payment-option" data-payment="cod">
                                        <input type="radio" id="cod" name="payment" value="cod">
                                        <div class="payment-icon">COD</div>
                                        <div>
                                            <h3>Cash on Delivery</h3>
                                            <p>Pay when you receive your order</p>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" data-payment="gcash">
                                        <input type="radio" id="gcash" name="payment" value="gcash">
                                        <div class="payment-icon">GC</div>
                                        <div>
                                            <h3>GCash</h3>
                                            <p>Pay securely with your GCash account</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="cod-details" class="payment-details">
                                    <p>You'll pay in cash when your order is delivered. Please have the exact amount ready.</p>
                                </div>
                                
                                <div id="gcash-details" class="payment-details">
                                    <p>After placing your order, you'll be redirected to GCash to complete your payment.</p>
                                </div>
                            </div>
                            
                            <button type="button" class="checkout-btn" id="complete-order-btn">Complete Order</button>
                        </form>
                    </div>
                    
                    <div class="order-summary">
                        <h2 class="section-title">Order Summary</h2>
                        
                        <div id="checkout-items">
                            <!-- Order items will be populated by JavaScript -->
                        </div>
                        
                        <div class="order-total">
                            <span>Total:</span>
                            <span class="total-amount"><span class="currency"></span><span id="checkout-total">0.00</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Profile Modal -->
        <div class="modal" id="profile-modal">
            <div class="modal-content">
                <button class="modal-close" id="close-profile-modal">&times;</button>
                <h2 class="modal-title">User Profile</h2>
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="profile-name">User Name</h2>
                            <p id="profile-email">user@example.com</p>
                            <p id="profile-role">Customer</p>
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profile-orders-count">0</div>
                                    <div class="profile-stat-label">Orders</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profile-wishlist-count">0</div>
                                    <div class="profile-stat-label">Wishlist</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profile-member-since">2023</div>
                                    <div class="profile-stat-label">Member Since</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-tabs">
                        <div class="profile-tab active" data-tab="account">Account Settings</div>
                        <div class="profile-tab" data-tab="password">Change Password</div>
                        
                        <div class="profile-tab" data-tab="security">Security</div>
                    </div>
                    
                    <div class="profile-tab-content active" id="account-tab">
                        <h3>Account Information</h3>
                        <form id="account-form" class="profile-form">
                            <div class="form-group">
                                <label for="profile-fullname">Full Name</label>
                                <input type="text" id="profile-fullname" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-email-input">Email Address</label>
                                <input type="email" id="profile-email-input" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-username">Username</label>
                                <input type="text" id="profile-username" required>
                            </div>
                            <div class="form-group">
                                <label for="profile-phone">Phone Number</label>
                                <input type="tel" id="profile-phone">
                            </div>
                            <div class="form-group">
                                <label for="profile-address">Address</label>
                                <textarea id="profile-address" rows="3"></textarea>
                            </div>
                            <div class="profile-actions">
                                <button type="submit" class="btn btn-primary">Update Profile</button>
                                <button type="button" class="btn btn-secondary" id="cancel-account-changes">Cancel</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="profile-tab-content" id="password-tab">
                        <h3>Change Password</h3>
                        <form id="password-form" class="profile-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" required>
                                <span class="password-toggle" id="toggle-current-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" required>
                                <span class="password-toggle" id="toggle-new-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                                <div class="password-requirements" id="profile-password-requirements">
                                    <div class="requirement" id="profile-req-length">
                                        <i class="fas fa-times"></i>
                                        At least 8 characters
                                    </div>
                                    <div class="requirement" id="profile-req-lowercase">
                                        <i class="fas fa-times"></i>
                                        One lowercase letter 
                                    </div>
                                    <div class="requirement" id="profile-req-uppercase">
                                        <i class="fas fa-times"></i>
                                        One uppercase letter 
                                    </div>
                                    <div class="requirement" id="profile-req-digit">
                                        <i class="fas fa-times"></i>
                                        One digit 
                                    </div>
                                    <div class="requirement" id="profile-req-special">
                                        <i class="fas fa-times"></i>
                                        One special character 
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="confirm-new-password">Confirm New Password</label>
                                <input type="password" id="confirm-new-password" required>
                                <span class="password-toggle" id="toggle-confirm-new-password">
                                    <i class="fas fa-eye"></i>
                                </span>
                            </div>
                            <div class="profile-actions">
                                <button type="submit" class="btn btn-primary" id="update-password-btn" disabled>Update Password</button>
                                <button type="button" class="btn btn-secondary" id="cancel-password-changes">Cancel</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="profile-tab-content" id="orders-tab">
                        <h3>Order History</h3>
                        <div id="profile-orders">
                            <!-- Order history will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="profile-tab-content" id="security-tab">
                        <h3>Security Settings</h3>
                        <div class="security-settings">
                            <div class="security-item">
                                <div class="security-info">
                                    <h4>Two-Factor Authentication</h4>
                                    <p>Add an extra layer of security to your account</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="two-factor-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="security-item">
                                <div class="security-info">
                                    <h4>Login Notifications</h4>
                                    <p>Get notified when someone logs into your account</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="login-notifications-toggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="security-item">
                                <div class="security-info">
                                    <h4>Session Management</h4>
                                    <p>View and manage your active sessions</p>
                                    <div class="last-updated">Last active: Today, 10:30 AM</div>
                                </div>
                                <button class="btn btn-primary btn-sm" id="view-sessions-btn">View Sessions</button>
                            </div>
                        </div>
                        <div class="profile-actions" style="margin-top: 30px;">
                            <button class="btn btn-primary" id="save-security-settings">Save Security Settings</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; text-align: center;">
                        <button class="btn btn-danger" id="logout-btn">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Logout Confirmation Modal -->
        <div class="modal" id="admin-logout-modal">
            <div class="modal-content" style="max-width: 400px; text-align: center;">
                <h2 class="modal-title">Confirm Logout</h2>
                <p>Are you sure you want to log out from the admin dashboard?</p>
                <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                    <button class="btn btn-danger" id="confirm-logout-btn">Logout</button>
                    <button class="btn btn-secondary" id="cancel-logout-btn">Cancel</button>
                </div>
            </div>
        </div>


    <script>
            // Predefined admin account (hidden from customers)
            const adminAccount = {
                username: "admin123",
                password: "Admin123!",
                role: "admin"
            };

            // Sample data for the application with realistic product images
            let products = [
                // Sofas 
                { id: 1, name: "Modern loaf Sofa", category: "sofa", price: 8999.99, stock: 15, dimensions: "80x36x34", description: "Comfortable modern leather sofa with premium finish", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 2, name: "Sectional Modern Sofa ", category: "sofa", price: 12999.99, stock: 4, dimensions: "120x40x36", description: "Large sectional sofa with chaise lounge", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 3, name: "Fabric Sofa", category: "sofa", price: 7599.99, stock: 8, dimensions: "85x35x32", description: "Soft fabric sofa with comfortable cushions", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Single Sofas
                { id: 4, name: "Loveseat Sofa", category: "single-sofa", price: 5500.00, stock: 7, dimensions: "60x32x32", description: "Compact loveseat perfect for small spaces", image: "/static/images/sofa.png", threshold: 10, featured: true, new: false },
                { id: 5, name: "Accent Chair", category: "single-sofa", price: 3200.00, stock: 12, dimensions: "28x32x30", description: "Elegant accent chair with wooden legs", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                { id: 6, name: "Recliner Chair", category: "single-sofa", price: 6800.00, stock: 5, dimensions: "35x40x38", description: "Comfortable recliner chair with footrest", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                
                // Gaming Chairs
                { id: 7, name: "Pro Gaming Chair", category: "gaming-chair", price: 4500.00, stock: 15, dimensions: "28x50x28", description: "Ergonomic gaming chair with lumbar support", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 8, name: "Racing Style Chair", category: "gaming-chair", price: 5200.00, stock: 8, dimensions: "30x52x30", description: "Racing style gaming chair with adjustable armrests", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                { id: 9, name: "Streamer Chair", category: "gaming-chair", price: 6800.00, stock: 6, dimensions: "32x54x32", description: "Premium gaming chair for streamers", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                
                // Gaming Tables
                { id: 10, name: "RGB Gaming Desk", category: "gaming-table", price: 7500.00, stock: 10, dimensions: "60x30x30", description: "LED RGB gaming desk with cable management", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 11, name: "L-Shaped Gaming Desk", category: "gaming-table", price: 9800.00, stock: 5, dimensions: "120x60x30", description: "Spacious L-shaped gaming desk", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Dining Tables
                { id: 12, name: "Oak Dining Table", category: "dining-table", price: 12500.00, stock: 8, dimensions: "72x30x36", description: "Solid oak dining table with elegant design", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 13, name: "Extendable Dining Table", category: "dining-table", price: 14500.00, stock: 4, dimensions: "80x30x36", description: "Extendable dining table for 6-8 people", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Coffee Tables
                { id: 14, name: "Glass Coffee Table", category: "coffee-table", price: 3200.00, stock: 20, dimensions: "48x18x18", description: "Modern coffee table with glass top", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                { id: 15, name: "Wooden Coffee Table", category: "coffee-table", price: 2800.00, stock: 15, dimensions: "42x16x16", description: "Rustic wooden coffee table", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Shoe Racks
                { id: 16, name: "5-Tier Shoe Rack", category: "shoe-rack", price: 1500.00, stock: 25, dimensions: "24x60x12", description: "Space-saving 5-tier shoe rack", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                { id: 17, name: "Metal Shoe Rack", category: "shoe-rack", price: 1200.00, stock: 18, dimensions: "20x48x10", description: "Durable metal shoe rack", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Dressers
                { id: 18, name: "6-Drawer Dresser", category: "dresser", price: 8500.00, stock: 7, dimensions: "48x32x18", description: "Spacious 6-drawer dresser", image: "/static/images/sofa.png", threshold: null, featured: true, new: false },
                { id: 19, name: "Mirror Dresser", category: "dresser", price: 9200.00, stock: 5, dimensions: "52x34x20", description: "Dresser with attached mirror", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Shelves
                { id: 20, name: "Bookshelf", category: "shelf", price: 4500.00, stock: 15, dimensions: "36x72x12", description: "Tall bookshelf with 5 adjustable shelves", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                { id: 21, name: "Floating Shelf Set", category: "shelf", price: 1800.00, stock: 22, dimensions: "24x6x4", description: "Set of 3 floating shelves", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Wall Shelves
                { id: 22, name: "Corner Wall Shelf", category: "wall-shelf", price: 1200.00, stock: 30, dimensions: "16x16x6", description: "Corner wall shelf for small spaces", image: "/static/images/sofa.png", threshold: null, featured: false, new: false },
                { id: 23, name: "Hexagon Wall Shelves", category: "wall-shelf", price: 1500.00, stock: 18, dimensions: "12x12x4", description: "Set of 3 hexagon wall shelves", image: "/static/images/sofa.png", threshold: null, featured: false, new: true },
                
                // Lamps
                { id: 24, name: "Bedside Lamp", category: "lamp", price: 2200.00, stock: 25, dimensions: "65x12x12", description: "Bedside LED lamp with adjustable lighting", image: "/static/images/bedside-lamp.jpg", threshold: null, featured: true, new: false },
                { id: 25, name: "Desk Lamp", category: "lamp", price: 800.00, stock: 40, dimensions: "15x8x8", description: "Adjustable LED desk lamp", image: "/static/images/bedside-lamp.jpg", threshold: null, featured: false, new: false },
                { id: 26, name: "Table Lamp", category: "lamp", price: 1200.00, stock: 30, dimensions: "20x10x10", description: "Elegant table lamp with fabric shade", image: "/static/images/bedside-lamp.jpg", threshold: null, featured: false, new: true }
            ];

            let orders = [
                { id: 1001, customer: "Marla", date: "2023-10-15", amount: 12499.98, status: "completed", items: [
                    { productId: 1, quantity: 1, price: 8999.99 },
                    { productId: 14, quantity: 1, price: 3200.00 },
                    { productId: 25, quantity: 1, price: 800.00 }
                ]},
                { id: 1002, customer: "Chloe", date: "2023-10-16", amount: 6500.00, status: "pending", items: [
                    { productId: 4, quantity: 1, price: 5500.00 }
                ]},
                { id: 1003, customer: "Juleane", date: "2023-10-17", amount: 9499.99, status: "processing", items: [
                    { productId: 12, quantity: 1, price: 12500.00 },
                    { productId: 7, quantity: 2, price: 9000.00 }
                ]}
            ];

            // Customer accounts
            let customers = [
                { id: 1, name: "Marla Dana", email: "marladana@gmail.com", username: "marla", password: "marla@123", provider: "email", phone: "09090768543", address: "123 Main St, Anytown, USA", createdAt: "2023-01-15" },
                { id: 2, name: "Jane Smith", email: "jane@example.com", username: "janesmith", password: "Password123!", provider: "email", phone: "+1-555-0102", address: "456 Oak Ave, Somewhere, USA", createdAt: "2023-03-22" },
                { id: 3, name: "Robert Johnson", email: "robert@example.com", username: "robertj", password: "Password123!", provider: "email", phone: "+1-555-0103", address: "789 Pine Rd, Nowhere, USA", createdAt: "2023-05-10" }
            ];

            let cart = [];
            let wishlist = [];
            let currentUser = null;
            let isAdmin = false;
            let buyNowProduct = null;
            let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
            
            // Admin-specific data
            let batches = [
                { id: 1, productId: 1, productName: "Modern Leather Sofa", arrivalDate: "2023-09-15", quantity: 20, remaining: 15 },
                { id: 2, productId: 12, productName: "Oak Dining Table", arrivalDate: "2023-09-20", quantity: 10, remaining: 8 },
                { id: 3, productId: 7, productName: "Pro Gaming Chair", arrivalDate: "2023-10-01", quantity: 30, remaining: 25 },
                { id: 4, productId: 7, productName: "Pro Gaming Chair", arrivalDate: "2023-10-10", quantity: 10, remaining: 10 }
            ];

            let transactions = [
                { id: 1, type: "sale", user: "Marla Mendoza", item: "Modern Leather Sofa", quantity: 1, date: "2023-10-15 14:30:22", amount: 8999.99 },
                { id: 2, type: "sale", user: "Jethro", item: "Glass Coffee Table", quantity: 1, date: "2023-10-15 14:30:22", amount: 3200.00 },
                { id: 3, type: "sale", user: "Senyora", item: "Desk Lamp", quantity: 1, date: "2023-10-15 14:30:22", amount: 800.00 },
                { id: 4, type: "sale", user: "Angela", item: "Loveseat Sofa", quantity: 1, date: "2023-10-16 09:15:47", amount: 5500.00 },
                { id: 5, type: "restock", user: "Admin", item: "Pro Gaming Chair", quantity: 10, date: "2023-10-17 11:20:33", amount: 0 },
                { id: 6, type: "sale", user: "Juleane", item: "Oak Dining Table", quantity: 1, date: "2023-10-17 16:45:12", amount: 12500.00 },
                { id: 7, type: "sale", user: "Chloe", item: "Pro Gaming Chair", quantity: 2, date: "2023-10-17 16:45:12", amount: 9000.00 }
            ];

            let adminSettings = {
                globalThreshold: 10,
                emailAlerts: true,
                dashboardAlerts: true,
                fifoEnabled: true
            };

            // ========== DATABASE WISHLIST FUNCTIONS ==========
            
            // Save wishlist to database - FIXED
            async function saveWishlistToDatabase(productId) {
                try {
                    const token = localStorage.getItem('token'); // GET JWT TOKEN
                    const response = await fetch('http://127.0.0.1:5000/api/wishlist/add', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` // ADD AUTHORIZATION HEADER
                        },
                        body: JSON.stringify({
                            product_id: productId // REMOVE user_id - backend will get it from JWT
                        })
                    });
                    
                    if (response.ok) {
                        console.log('Added to wishlist in database');
                        return true;
                    } else {
                        console.error('Failed to save to database wishlist');
                        return false;
                    }
                } catch (error) {
                    console.error('Error saving to database wishlist:', error);
                    return false;
                }
            }

            // Remove wishlist from database - FIXED
            async function removeWishlistFromDatabase(productId) {
                try {
                    const token = localStorage.getItem('token'); // GET JWT TOKEN
                    const response = await fetch(`http://127.0.0.1:5000/api/wishlist/remove/${currentUser.id}/${productId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}` // ADD AUTHORIZATION HEADER
                        }
                    });
                    
                    if (response.ok) {
                        console.log('Removed from wishlist in database');
                        return true;
                    } else {
                        console.error('Failed to remove from database wishlist');
                        return false;
                    }
                } catch (error) {
                    console.error('Error removing from database wishlist:', error);
                    return false;
                }
            }

            // Load wishlist from database - FIXED
            async function loadWishlistFromDatabase() {
                if (!currentUser) return;
                
                try {
                    const token = localStorage.getItem('token'); // GET JWT TOKEN
                    const response = await fetch('http://127.0.0.1:5000/api/wishlist', { //  TAMANG ENDPOINT
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}` // ADD AUTHORIZATION HEADER
                        }
                    });
                    
                    if (response.ok) {
                        const dbWishlist = await response.json();
                        console.log('Loaded wishlist from database:', dbWishlist);
                        
                        //  FIX: Reset wishlist to only what's in database
                        wishlist = dbWishlist.map(dbItem => {
                            const product = products.find(p => p.id === dbItem.product.id);
                            return product ? {
                                id: product.id,
                                name: product.name,
                                price: product.price,
                                image: product.image
                            } : null;
                        }).filter(item => item !== null);
                        
                        saveWishlist();
                    } else {
                        console.error('Failed to load wishlist from database');
                    }
                } catch (error) {
                    console.error('Error loading wishlist from database:', error);
                }
            }

            // ========== ENHANCED WISHLIST FUNCTION ==========
            
            // Toggle product in wishlist - UPDATED VERSION WITH DATABASE SYNC
            async function toggleWishlist(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const existingIndex = wishlist.findIndex(item => item.id === productId);
                
                if (existingIndex !== -1) {
                    // Remove from wishlist
                    wishlist.splice(existingIndex, 1);
                    await removeWishlistFromDatabase(productId);
                    showToast('Removed from wishlist!', 'success');
                } else {
                    // Add to wishlist
                    wishlist.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image
                    });
                    await saveWishlistToDatabase(productId);
                    showToast('Added to wishlist!', 'success');
                }
                
                saveWishlist();
                renderCustomerProducts();
                renderFeaturedProducts();
                renderNewProducts();
            }

            // ========== REST OF YOUR EXISTING CODE ==========

            // Product Manager with reactive updates
            class ProductManager {
                constructor() {
                    this.products = products; // Use the global products array
                    this.subscribers = [];    // Components that need updates
                }

                // Subscribe to product changes
                subscribe(callback) {
                    this.subscribers.push(callback);
                    return () => {
                        this.subscribers = this.subscribers.filter(sub => sub !== callback);
                    };
                }

                // Notify all subscribers of changes
                notifySubscribers() {
                    this.subscribers.forEach(callback => callback(this.products));
                }

                // Update product name
                updateProductName(productId, newName) {
                    const productIndex = this.products.findIndex(p => p.id === productId);
                    if (productIndex !== -1) {
                        this.products[productIndex].name = newName;
                        
                        // Save to localStorage
                        this.saveProducts();
                        
                        // Notify all subscribers
                        this.notifySubscribers();
                        
                        return true;
                    }
                    return false;
                }

                // Get product by ID
                getProduct(productId) {
                    return this.products.find(p => p.id === productId);
                }

                // Initialize with existing products
                initialize(productsArray) {
                    this.products = productsArray;
                    // Update the global products reference
                    products = productsArray;
                }

                // Save products to localStorage
                saveProducts() {
                    localStorage.setItem('products', JSON.stringify(this.products));
                    // Update the global products reference
                    products = this.products;
                }
            }

            // Initialize the product manager
            const productManager = new ProductManager();
            productManager.initialize(products);

            // Update product card in customer dashboard
            function updateProductCard(productId, productData) {
                const productCards = document.querySelectorAll('.product-card');
                productCards.forEach(card => {
                    const cardProductId = parseInt(card.querySelector('.add-to-cart-btn').getAttribute('data-id'));
                    if (cardProductId === productId) {
                        // Update name
                        const nameElement = card.querySelector('.product-name');
                        if (nameElement) {
                            nameElement.textContent = productData.name;
                        }
                        
                        // Update any other elements if needed
                        const categoryElement = card.querySelector('.product-category');
                        if (categoryElement && productData.category) {
                            categoryElement.textContent = productData.category.split('-').map(word => 
                                word.charAt(0).toUpperCase() + word.slice(1)
                            ).join(' ');
                        }
                    }
                });
            }

            // Update featured products section
            function updateFeaturedProduct(productId, productData) {
                const featuredProducts = document.querySelectorAll('#featured-products .product-card');
                featuredProducts.forEach(card => {
                    const cardProductId = parseInt(card.querySelector('.add-to-cart-btn').getAttribute('data-id'));
                    if (cardProductId === productId) {
                        const nameElement = card.querySelector('.product-name');
                        if (nameElement) {
                            nameElement.textContent = productData.name;
                        }
                    }
                });
            }

            // Update new products section
            function updateNewProduct(productId, productData) {
                const newProducts = document.querySelectorAll('#new-products .product-card');
                newProducts.forEach(card => {
                    const cardProductId = parseInt(card.querySelector('.add-to-cart-btn').getAttribute('data-id'));
                    if (cardProductId === productId) {
                        const nameElement = card.querySelector('.product-name');
                        if (nameElement) {
                            nameElement.textContent = productData.name;
                        }
                    }
                });
            }

            // Update inventory table
            function updateInventoryTable(productId, productData) {
                const inventoryRows = document.querySelectorAll('#inventory-table tbody tr');
                inventoryRows.forEach(row => {
                    const rowProductId = parseInt(row.cells[0].textContent);
                    if (rowProductId === productId) {
                        // Update name in second column
                        row.cells[1].textContent = productData.name;
                        
                        // Update category in third column
                        row.cells[2].textContent = productData.category.split('-').map(word => 
                            word.charAt(0).toUpperCase() + word.slice(1)
                        ).join(' ');
                    }
                });
            }

            // Update product detail modal if open
            function updateProductDetailModal(productId, productData) {
                const modal = document.getElementById('product-detail-modal');
                if (modal.classList.contains('active')) {
                    const modalProductId = parseInt(modal.querySelector('.add-to-cart-btn').getAttribute('data-id'));
                    if (modalProductId === productId) {
                        const nameElement = modal.querySelector('.product-detail-name');
                        if (nameElement) {
                            nameElement.textContent = productData.name;
                        }
                    }
                }
            }

            // Update cart items
            function updateCartProductName(productId, newName) {
                const cartItems = document.querySelectorAll('.cart-item');
                cartItems.forEach(item => {
                    const itemProductId = parseInt(item.querySelector('.remove-from-cart').getAttribute('data-id'));
                    if (itemProductId === productId) {
                        const nameElement = item.querySelector('.cart-item-name');
                        if (nameElement) {
                            nameElement.textContent = newName;
                        }
                    }
                });
            }

            // Update wishlist items
            function updateWishlistProductName(productId, newName) {
                const wishlistItems = document.querySelectorAll('.wishlist-item');
                wishlistItems.forEach(item => {
                    const itemProductId = parseInt(item.querySelector('.remove-from-wishlist').getAttribute('data-id'));
                    if (itemProductId === productId) {
                        const nameElement = item.querySelector('.wishlist-item-name');
                        if (nameElement) {
                            nameElement.textContent = newName;
                        }
                    }
                });
            }

            // Subscribe to product changes
            productManager.subscribe((updatedProducts) => {
                // This function will be called whenever any product changes
                console.log('Products updated, refreshing UI...');
                
                // You can trigger a re-render of specific sections here
                if (document.getElementById('customer-dashboard') && 
                    !document.getElementById('customer-dashboard').classList.contains('hidden')) {
                    renderCustomerProducts();
                }
                
                if (document.getElementById('home-page') && 
                    !document.getElementById('home-page').classList.contains('hidden')) {
                    renderFeaturedProducts();
                    renderNewProducts();
                }
                
                if (document.getElementById('admin-dashboard') && 
                    !document.getElementById('admin-dashboard').classList.contains('hidden')) {
                    renderInventory();
                }
            });

            // Enhanced product update function
            function updateProductAndUI(productId, updates) {
                const product = productManager.getProduct(productId);
                if (!product) {
                    console.error('Product not found');
                    return false;
                }
                
                // Update the product
                Object.assign(product, updates);
                
                // Update specific UI elements immediately
                if (updates.name) {
                    updateProductCard(productId, product);
                    updateFeaturedProduct(productId, product);
                    updateNewProduct(productId, product);
                    updateInventoryTable(productId, product);
                    updateProductDetailModal(productId, product);
                    updateCartProductName(productId, updates.name);
                    updateWishlistProductName(productId, updates.name);
                }
                
                // Notify all subscribers (will trigger re-renders)
                productManager.notifySubscribers();
                
                return true;
            }

            // Add quick edit to inventory table cells
            function makeProductNameEditable() {
                const nameCells = document.querySelectorAll('#inventory-table td:nth-child(2)');
                
                nameCells.forEach(cell => {
                    cell.addEventListener('dblclick', function() {
                        const productId = parseInt(this.parentNode.cells[0].textContent);
                        const currentName = this.textContent;
                        
                        // Create input field
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = currentName;
                        input.className = 'product-name-edit';
                        
                        // Replace cell content with input
                        this.innerHTML = '';
                        this.appendChild(input);
                        input.focus();
                        
                        // Handle input completion
                        const handleCompletion = () => {
                            const newName = input.value.trim();
                            if (newName && newName !== currentName) {
                                updateProductAndUI(productId, { name: newName });
                                showToast('Product name updated!', 'success');
                            }
                            this.textContent = newName || currentName;
                        };
                        
                        input.addEventListener('blur', handleCompletion);
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                handleCompletion();
                            }
                        });
                    });
                });
            }

            // DOM Elements
            const loginSection = document.getElementById('login-section');
            const homePage = document.getElementById('home-page');
            const customerDashboard = document.getElementById('customer-dashboard');
            const adminDashboard = document.getElementById('admin-dashboard');
            const customerLoginForm = document.getElementById('customer-login-form');
            const customerSignupForm = document.getElementById('customer-signup-form');
            const adminLoginForm = document.getElementById('admin-login-form');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const adminForm = document.getElementById('admin-form');
            const customerToggle = document.getElementById('customer-toggle');
            const adminToggle = document.getElementById('admin-toggle');
            const switchToSignup = document.getElementById('switch-to-signup');
            const switchToLogin = document.getElementById('switch-to-login');
            const loginMessage = document.getElementById('login-message');
            const inventoryTable = document.getElementById('inventory-table').querySelector('tbody');
            const ordersTable = document.getElementById('orders-table').querySelector('tbody');
            const transactionLogs = document.getElementById('transaction-logs');
            const batchTable = document.getElementById('batch-table').querySelector('tbody');
            const thresholdTable = document.getElementById('threshold-table').querySelector('tbody');
            const totalProducts = document.getElementById('total-products');
            const lowStockCount = document.getElementById('low-stock-count');
            const totalSales = document.getElementById('total-sales');
            const pendingOrders = document.getElementById('pending-orders');
            const inventoryAlerts = document.getElementById('inventory-alerts');
            const productGrid = document.getElementById('product-grid');
            const cartItems = document.getElementById('cart-items');
            const wishlistItems = document.getElementById('wishlist-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotalAmount = document.getElementById('cart-total-amount');
            const checkoutItems = document.getElementById('checkout-items');
            const checkoutTotal = document.getElementById('checkout-total');
            const featuredProducts = document.getElementById('featured-products');
            const newProducts = document.getElementById('new-products');
            const recentSearchesContainer = document.getElementById('recent-searches');
            const toast = document.getElementById('toast');
            const profileModal = document.getElementById('profile-modal');

            // Modal Elements
            const productModal = document.getElementById('product-modal');
            const productDetailModal = document.getElementById('product-detail-modal');
            const stockModal = document.getElementById('stock-modal');
            const cartModal = document.getElementById('cart-modal');
            const wishlistModal = document.getElementById('wishlist-modal');
            const checkoutModal = document.getElementById('checkout-modal');

            // Event Listeners
            document.addEventListener('DOMContentLoaded', initApp);
            loginForm.addEventListener('submit', handleCustomerLogin);
            signupForm.addEventListener('submit', handleCustomerSignup);
            adminForm.addEventListener('submit', handleAdminLogin);
            customerToggle.addEventListener('click', () => switchUserType('customer'));
            adminToggle.addEventListener('click', () => switchUserType('admin'));
            switchToSignup.addEventListener('click', () => switchCustomerForm('signup'));
            switchToLogin.addEventListener('click', () => switchCustomerForm('login'));
            document.getElementById('add-product-btn').addEventListener('click', () => openProductModal());
            document.getElementById('save-alert-settings-btn').addEventListener('click', saveAlertSettings);
            document.getElementById('generate-report-btn').addEventListener('click', generateReport);
            document.getElementById('generate-report-period-btn').addEventListener('click', generatePeriodReport);
            document.getElementById('view-cart-btn').addEventListener('click', () => openCartModal());
            document.getElementById('view-wishlist-btn').addEventListener('click', () => openWishlistModal());
            document.getElementById('continue-shopping-btn').addEventListener('click', () => closeCartModal());
            document.getElementById('checkout-btn').addEventListener('click', openCheckoutModal);
            document.getElementById('close-wishlist-btn').addEventListener('click', () => closeWishlistModal());
            document.getElementById('complete-order-btn').addEventListener('click', handleCheckout);
            document.getElementById('shop-now-btn').addEventListener('click', () => showCustomerDashboard());
            document.getElementById('view-all-featured').addEventListener('click', (e) => {
                e.preventDefault();
                showCustomerDashboard();
            });
            document.getElementById('view-all-new').addEventListener('click', (e) => {
                e.preventDefault();
                showCustomerDashboard();
            });
            document.getElementById('nav-profile').addEventListener('click', (e) => {
                e.preventDefault();
                openProfileModal();
            });
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('close-profile-modal').addEventListener('click', () => closeProfileModal());
            document.getElementById('clear-searches').addEventListener('click', (e) => {
                e.preventDefault();
                clearRecentSearches();
            });
            document.getElementById('account-form').addEventListener('submit', updateProfile);
            document.getElementById('password-form').addEventListener('submit', updatePassword);

            // Admin logout modal buttons
            document.getElementById('confirm-logout-btn').addEventListener('click', () => {
                const adminLogoutModal = document.getElementById('admin-logout-modal');
                adminLogoutModal.classList.remove('active');
                logout();
            });
            document.getElementById('cancel-logout-btn').addEventListener('click', () => {
                const adminLogoutModal = document.getElementById('admin-logout-modal');
                adminLogoutModal.classList.remove('active');
            });
            // Social login buttons
            // Add order filter functionality
            document.getElementById('order-filter').addEventListener('change', renderOrders);

            document.getElementById('google-login').addEventListener('click', () => {
                showToast('Google login would be implemented here', 'info');
            });
            document.getElementById('facebook-login').addEventListener('click', () => {
                showToast('Facebook login would be implemented here', 'info');
            });
            document.getElementById('phone-login').addEventListener('click', () => {
                showToast('Phone login would be implemented here', 'info');
            });

            // Password toggle functionality
            document.getElementById('toggle-password').addEventListener('click', () => togglePassword('password'));
            document.getElementById('toggle-signup-password').addEventListener('click', () => togglePassword('signup-password'));
            document.getElementById('toggle-confirm-password').addEventListener('click', () => togglePassword('signup-confirm-password'));
            document.getElementById('toggle-admin-password').addEventListener('click', () => togglePassword('admin-password'));
            document.getElementById('toggle-current-password').addEventListener('click', () => togglePassword('current-password'));
            document.getElementById('toggle-new-password').addEventListener('click', () => togglePassword('new-password'));
            document.getElementById('toggle-confirm-new-password').addEventListener('click', () => togglePassword('confirm-new-password'));

            // Password validation
            document.getElementById('signup-password').addEventListener('input', validatePassword);
            document.getElementById('new-password').addEventListener('input', validateProfilePassword);

            // Modal close buttons
            document.getElementById('close-product-modal').addEventListener('click', () => closeProductModal());
            document.getElementById('close-product-detail-modal').addEventListener('click', () => closeProductDetailModal());
            document.getElementById('close-stock-modal').addEventListener('click', () => closeStockModal());
            document.getElementById('close-cart-modal').addEventListener('click', () => closeCartModal());
            document.getElementById('close-wishlist-modal').addEventListener('click', () => closeWishlistModal());
            document.getElementById('close-checkout-modal').addEventListener('click', () => closeCheckoutModal());

            // Product form submission
            document.getElementById('product-form').addEventListener('submit', handleProductFormSubmit);
            document.getElementById('stock-form').addEventListener('submit', handleStockFormSubmit);

            // Navigation
            document.getElementById('nav-home').addEventListener('click', (e) => {
                e.preventDefault();
                if (isAdmin) {
                    showAdminDashboard();
                } else {
                    showHomePage();
                }
            });
            document.getElementById('nav-products').addEventListener('click', (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    showCustomerDashboard();
                }
            });
            document.getElementById('nav-cart').addEventListener('click', (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to view your cart', 'error');
                    } else {
                        openCartModal();
                    }
                }
            });
            document.getElementById('nav-wishlist').addEventListener('click', (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to view your wishlist', 'error');
                    } else {
                        openWishlistModal();
                    }
                }
            });
            document.getElementById('nav-orders').addEventListener('click', (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to view your orders', 'error');
                    } else {
                        showOrderHistory();
                    }
                }
            });

            // Search and filter
            document.getElementById('product-search').addEventListener('input', function() {
                const searchTerm = this.value;
                if (searchTerm.length > 2) {
                    addToRecentSearches(searchTerm);
                }
                renderCustomerProducts();
            });
            document.getElementById('category-filter').addEventListener('change', renderCustomerProducts);

            // Add this event listener after the category filter event listener
            document.getElementById('sort-price').addEventListener('change', renderCustomerProducts);

            // Profile tabs
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    if (tabId === 'orders') {
                        renderProfileOrders();
                    }
                });
            });

            // Profile cancel buttons
            document.getElementById('cancel-account-changes').addEventListener('click', function() {
                document.getElementById('account-form').reset();
                // Restore original values
                document.getElementById('profile-fullname').value = currentUser.name || '';
                document.getElementById('profile-email-input').value = currentUser.email || '';
                document.getElementById('profile-username').value = currentUser.username || '';
                document.getElementById('profile-phone').value = currentUser.phone || '';
                document.getElementById('profile-address').value = currentUser.address || '';
            });
            
            document.getElementById('cancel-password-changes').addEventListener('click', function() {
                document.getElementById('password-form').reset();
                document.getElementById('update-password-btn').disabled = true;
                
                // Reset requirement indicators
                const requirements = document.querySelectorAll('#profile-password-requirements .requirement');
                requirements.forEach(req => {
                    const icon = req.querySelector('i');
                    req.classList.remove('valid', 'invalid');
                    icon.classList.remove('fa-check', 'fa-times');
                    icon.classList.add('fa-times');
                });
            });
            
            // Security settings
            document.getElementById('save-security-settings').addEventListener('click', saveSecuritySettings);
            document.getElementById('view-sessions-btn').addEventListener('click', viewActiveSessions);

            // Enhanced Checkout Payment Options
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Check the radio button
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    // Hide all payment details
                    document.querySelectorAll('.payment-details').forEach(detail => detail.classList.remove('active'));
                    
                    // Show selected payment details
                    const paymentType = this.getAttribute('data-payment');
                    const detailsElement = document.getElementById(`${paymentType}-details`);
                    if (detailsElement) {
                        detailsElement.classList.add('active');
                    }
                });
            });

            // Add this CSS for the editable field
            const style = document.createElement('style');
            style.textContent = `
                .product-name-edit {
                    width: 100%;
                    padding: 4px 8px;
                    border: 2px solid var(--secondary);
                    border-radius: 4px;
                    font-size: 14px;
                }
                
                #inventory-table td:nth-child(2):hover {
                    background-color: #f0f8ff;
                    cursor: pointer;
                }
            `;
            document.head.appendChild(style);

            // Initialize the application
            function initApp() {
                // Reset admin state on page load
                isAdmin = false;
                currentUser = null;
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    isAdmin = currentUser.role === 'admin';
                    updateNavigation(); // Update navigation based on user role
                    
                    // Load wishlist from database for logged-in users
                    if (!isAdmin) {
                        loadWishlistFromDatabase();
                    }
                    
                    if (isAdmin) {
                        showAdminDashboard();
                    } else {
                        showHomePage();
                    }
                } else {
                    updateNavigation(); // Ensure nav is in logged-out state
                    showLogin();
                }
                
                // Load saved data
                const savedProducts = localStorage.getItem('products');
                if (savedProducts) products = JSON.parse(savedProducts);
                
                const savedOrders = localStorage.getItem('orders');
                if (savedOrders) orders = JSON.parse(savedOrders);
                
                const savedCustomers = localStorage.getItem('customers');
                if (savedCustomers) customers = JSON.parse(savedCustomers);
                
                const savedBatches = localStorage.getItem('batches');
                if (savedBatches) batches = JSON.parse(savedBatches);
                
                const savedThresholds = localStorage.getItem('thresholds');
                if (savedThresholds) thresholds = JSON.parse(savedThresholds);
                
                const savedTransactions = localStorage.getItem('transactions');
                if (savedTransactions) transactions = JSON.parse(savedTransactions);
                
                const savedAdminSettings = localStorage.getItem('adminSettings');
                if (savedAdminSettings) {
                    adminSettings = JSON.parse(savedAdminSettings);
                    document.getElementById('global-threshold').value = adminSettings.globalThreshold;
                    document.getElementById('email-alerts-toggle').checked = adminSettings.emailAlerts;
                    document.getElementById('dashboard-alerts-toggle').checked = adminSettings.dashboardAlerts;
                    document.getElementById('fifo-toggle').checked = adminSettings.fifoEnabled;
                }

                // Load cart and wishlist
                const savedCart = localStorage.getItem('cart');
                if (savedCart) cart = JSON.parse(savedCart);
                
                const savedWishlist = localStorage.getItem('wishlist');
                if (savedWishlist) wishlist = JSON.parse(savedWishlist);
                
                const savedRecentSearches = localStorage.getItem('recentSearches');
                if (savedRecentSearches) recentSearches = JSON.parse(savedRecentSearches);
                
                updateCartCount();
                renderRecentSearches();
            }

            // Toggle password visibility
            function togglePassword(fieldId) {
                const passwordField = document.getElementById(fieldId);
                const toggleIcon = document.getElementById(`toggle-${fieldId}`).querySelector('i');
                
                if (passwordField.type === 'password') {
                    passwordField.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                } else {
                    passwordField.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                }
            }

            // Validate password requirements
            function validatePassword() {
                const password = document.getElementById('signup-password').value;
                const signupBtn = document.getElementById('signup-btn');
                
                // Check requirements
                const hasMinLength = password.length >= 8;
                const hasLowercase = /[a-z]/.test(password);
                const hasUppercase = /[A-Z]/.test(password);
                const hasDigit = /\d/.test(password);
                const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
                
                // Update requirement indicators
                updateRequirement('req-length', hasMinLength);
                updateRequirement('req-lowercase', hasLowercase);
                updateRequirement('req-uppercase', hasUppercase);
                updateRequirement('req-digit', hasDigit);
                updateRequirement('req-special', hasSpecial);
                
                // Enable/disable signup button
                const isValid = hasMinLength && hasLowercase && hasUppercase && hasDigit && hasSpecial;
                signupBtn.disabled = !isValid;
                
                return isValid;
            }

            // Validate profile password requirements
            function validateProfilePassword() {
                const password = document.getElementById('new-password').value;
                const updateBtn = document.getElementById('update-password-btn');
                
                // Check requirements
                const hasMinLength = password.length >= 8;
                const hasLowercase = /[a-z]/.test(password);
                const hasUppercase = /[A-Z]/.test(password);
                const hasDigit = /\d/.test(password);
                const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
                
                // Update requirement indicators
                updateRequirement('profile-req-length', hasMinLength);
                updateRequirement('profile-req-lowercase', hasLowercase);
                updateRequirement('profile-req-uppercase', hasUppercase);
                updateRequirement('profile-req-digit', hasDigit);
                updateRequirement('profile-req-special', hasSpecial);
                
                // Enable/disable update button
                const isValid = hasMinLength && hasLowercase && hasUppercase && hasDigit && hasSpecial;
                updateBtn.disabled = !isValid;
                
                return isValid;
            }

            // Update requirement indicator
            function updateRequirement(id, isValid) {
                const requirement = document.getElementById(id);
                const icon = requirement.querySelector('i');
                
                if (isValid) {
                    requirement.classList.add('valid');
                    requirement.classList.remove('invalid');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-check');
                } else {
                    requirement.classList.add('invalid');
                    requirement.classList.remove('valid');
                    icon.classList.remove('fa-check');
                    icon.classList.add('fa-times');
                }
            }

            // Show home page
            function showHomePage() {
                loginSection.classList.add('hidden');
                homePage.classList.remove('hidden');
                customerDashboard.classList.add('hidden');
                adminDashboard.classList.add('hidden');
                renderFeaturedProducts();
                renderNewProducts();
                renderRecentSearches();
            }

            // Render featured products
            function renderFeaturedProducts() {
                featuredProducts.innerHTML = '';
                
                const featured = products.filter(product => product.featured);
                
                featured.forEach(product => {
                    const isInWishlist = wishlist.some(item => item.id === product.id);
                    
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image">
                            <img src="${product.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-category">${product.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</p>
                            <p class="product-price"><span class="currency"></span>${product.price.toFixed(2)}</p>
                            <div class="product-actions">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                <button class="btn btn-success btn-sm buy-now-btn" data-id="${product.id}">Buy Now</button>
                                <button class="btn ${isInWishlist ? 'btn-danger' : 'btn-warning'} btn-sm wishlist-btn" data-id="${product.id}">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="btn btn-primary btn-sm view-details-btn" data-id="${product.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    featuredProducts.appendChild(productCard);
                });
                
                // Add event listeners to buttons
                addProductEventListeners(featuredProducts);
            }

            // Render new products
            function renderNewProducts() {
                newProducts.innerHTML = '';
                
                const newProductsList = products.filter(product => product.new);
                
                newProductsList.forEach(product => {
                    const isInWishlist = wishlist.some(item => item.id === product.id);
                    
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image">
                            <img src="${product.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-category">${product.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</p>
                            <p class="product-price"><span class="currency"></span>${product.price.toFixed(2)}</p>
                            <div class="product-actions">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                <button class="btn btn-success btn-sm buy-now-btn" data-id="${product.id}">Buy Now</button>
                                <button class="btn ${isInWishlist ? 'btn-danger' : 'btn-warning'} btn-sm wishlist-btn" data-id="${product.id}">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="btn btn-primary btn-sm view-details-btn" data-id="${product.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    newProducts.appendChild(productCard);
                });
                
                // Add event listeners to buttons
                addProductEventListeners(newProducts);
            }

            // Render recent searches
            function renderRecentSearches() {
                recentSearchesContainer.innerHTML = '';
                
                if (recentSearches.length === 0) {
                    recentSearchesContainer.innerHTML = '<p>No recent searches</p>';
                    return;
                }
                
                recentSearches.forEach(search => {
                    const searchTag = document.createElement('div');
                    searchTag.className = 'search-tag';
                    searchTag.textContent = search;
                    searchTag.addEventListener('click', () => {
                        document.getElementById('product-search').value = search;
                        renderCustomerProducts();
                    });
                    
                    recentSearchesContainer.appendChild(searchTag);
                });
            }

            // Add to recent searches
            function addToRecentSearches(searchTerm) {
                // Remove if already exists
                const existingIndex = recentSearches.indexOf(searchTerm);
                if (existingIndex !== -1) {
                    recentSearches.splice(existingIndex, 1);
                }
                
                // Add to beginning
                recentSearches.unshift(searchTerm);
                
                // Keep only last 5 searches
                if (recentSearches.length > 5) {
                    recentSearches.pop();
                }
                
                saveRecentSearches();
                renderRecentSearches();
            }

            // Clear recent searches
            function clearRecentSearches() {
                recentSearches = [];
                saveRecentSearches();
                renderRecentSearches();
            }

            // Save recent searches
            function saveRecentSearches() {
                localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            }

            // Add product event listeners to a container
            function addProductEventListeners(container) {
                // Add to cart buttons
                container.querySelectorAll('.add-to-cart-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        if (!currentUser) {
                            showLogin();
                            showLoginMessage('Please log in to add items to cart', 'error');
                            return;
                        }
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        addToCart(productId);
                    });
                });
                
                // Buy now buttons
                container.querySelectorAll('.buy-now-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        if (!currentUser) {
                            showLogin();
                            showLoginMessage('Please log in to purchase items', 'error');
                            return;
                        }
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        buyNow(productId);
                    });
                });
                
                // Wishlist buttons
                container.querySelectorAll('.wishlist-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        if (!currentUser) {
                            showLogin();
                            showLoginMessage('Please log in to add items to wishlist', 'error');
                            return;
                        }
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        toggleWishlist(productId);
                    });
                });
                
                // View details buttons
                container.querySelectorAll('.view-details-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        openProductDetailModal(productId);
                    });
                });
            }

            // Show admin login form when hidden button is clicked
            function showAdminLogin() {
                switchUserType('admin');
                document.getElementById('admin-username').value = adminAccount.username;
                document.getElementById('admin-password').value = adminAccount.password;
            }

            // Switch between customer and admin login
            function switchUserType(userType) {
                if (userType === 'customer') {
                    customerToggle.classList.add('active');
                    adminToggle.classList.remove('active');
                    customerLoginForm.classList.remove('hidden');
                    customerSignupForm.classList.add('hidden');
                    adminLoginForm.classList.add('hidden');
                    switchCustomerForm('login');
                } else if (userType === 'admin') {
                    customerToggle.classList.remove('active');
                    adminToggle.classList.add('active');
                    customerLoginForm.classList.add('hidden');
                    customerSignupForm.classList.add('hidden');
                    adminLoginForm.classList.remove('hidden');
                }
                loginMessage.textContent = '';
            }

            // Switch between login and signup forms for customers
            function switchCustomerForm(formType) {
                if (formType === 'login') {
                    customerLoginForm.classList.remove('hidden');
                    customerSignupForm.classList.add('hidden');
                    switchToSignup.classList.remove('hidden');
                    switchToLogin.classList.add('hidden');
                } else if (formType === 'signup') {
                    customerLoginForm.classList.add('hidden');
                    customerSignupForm.classList.remove('hidden');
                    switchToSignup.classList.add('hidden');
                    switchToLogin.classList.remove('hidden');
                }
                loginMessage.textContent = '';
            }

            // Handle customer login - FIXED WITH BACKEND LOGIN
            async function handleCustomerLogin(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (!username || !password) {
                    showLoginMessage('Please enter both username and password', 'error');
                    return;
                }
                
                try {
                    // USE BACKEND LOGIN
                    const response = await fetch('http://127.0.0.1:5000/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        //  SAVE THE JWT TOKEN
                        localStorage.setItem('token', result.access_token);
                        
                        currentUser = { 
                            id: result.user.id,
                            name: result.user.full_name,
                            username: result.user.username,
                            email: result.user.email,
                            role: 'customer'
                        };
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // Load wishlist from database
                        await loadWishlistFromDatabase();
                        
                        showHomePage();
                        showLoginMessage('Login successful!', 'success');
                        showToast('Welcome back, ' + currentUser.name + '!', 'success');
                        isAdmin = false;
                        updateNavigation();
                    } else {
                        showLoginMessage(result.msg || 'Login failed', 'error');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showLoginMessage('Login failed. Please try again.', 'error');
                }
            }

            // Handle customer signup - FIXED
            async function handleCustomerSignup(e) {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const username = document.getElementById('signup-username').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm-password').value;
                
                if (!name || !email || !username || !password || !confirmPassword) {
                    showLoginMessage('Please fill in all fields', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showLoginMessage('Passwords do not match', 'error');
                    return;
                }
                
                try {
                    const response = await fetch('http://127.0.0.1:5000/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            full_name: name,
                            email: email,
                            username: username,
                            password: password
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        showLoginMessage('Account created successfully! Please login.', 'success');
                        // Switch to login form after successful signup
                        switchCustomerForm('login');
                    } else {
                        showLoginMessage(result.msg || 'Signup failed', 'error');
                    }
                } catch (error) {
                    console.error('Signup error:', error);
                    showLoginMessage('Signup failed. Please try again.', 'error');
                }
            }

            // Handle admin login
            function handleAdminLogin(e) {
                e.preventDefault();
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                if (!username || !password) {
                    showLoginMessage('Please enter both username and password', 'error');
                    return;
                }
                
                // Check for admin login
                if (username === adminAccount.username && password === adminAccount.password) {
                    currentUser = {
                        username: adminAccount.username,
                        role: 'admin'
                    };

                    // Set admin state first so navigation updates immediately
                    isAdmin = true;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    // Update navigation immediately (CSS will hide .customer-nav via .admin-nav rule)
                    updateNavigation();

                    // Show admin dashboard and feedback
                    showAdminDashboard();
                    showLoginMessage('Admin login successful!', 'success');
                    showToast('Welcome back, Admin!', 'success');

                    // Fallback: ensure customer nav items are hidden inline in case CSS hasn't applied yet
                    document.querySelectorAll('.customer-nav').forEach(item => item.style.display = 'none');
                } else {
                    showLoginMessage('Invalid admin credentials', 'error');
                }
            }

            // Show login message
            function showLoginMessage(message, type) {
                loginMessage.textContent = message;
                if (type === 'error') {
                    loginMessage.style.color = 'red';
                } else if (type === 'success') {
                    loginMessage.style.color = 'green';
                } else {
                    loginMessage.style.color = 'blue';
                }
            }

            // Show toast notification
            // Show toast notification - Updated for top position
            function showToast(message, type = 'info') {
                // Set toast content and type
                toast.textContent = message;
                toast.className = 'toast ' + type;
                
                // Add icon based on type
                let icon = '';
                switch(type) {
                    case 'success':
                        icon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-circle"></i>';
                        break;
                    case 'warning':
                        icon = '<i class="fas fa-exclamation-triangle"></i>';
                        break;
                    case 'info':
                    default:
                        icon = '<i class="fas fa-info-circle"></i>';
                        break;
                }
                
                toast.innerHTML = icon + ' ' + message;
                
                // Show the toast
                toast.classList.add('show');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    hideToast();
                }, 3000);
            }

            // Hide toast notification
            function hideToast() {
                toast.classList.remove('show');
            }

            // Show login screen
            function showLogin() {
                loginSection.classList.remove('hidden');
                homePage.classList.add('hidden');
                customerDashboard.classList.add('hidden');
                adminDashboard.classList.add('hidden');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
                loginMessage.textContent = '';
                switchUserType('customer');
                switchCustomerForm('login');
                updateNavigation();
            }

            // Show customer dashboard
            function showCustomerDashboard() {
                loginSection.classList.add('hidden');
                homePage.classList.add('hidden');
                customerDashboard.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
                renderCustomerProducts();
            }

            // Show admin dashboard
            function showAdminDashboard() {
                loginSection.classList.add('hidden');
                homePage.classList.add('hidden');
                customerDashboard.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                updateAdminStats();
                renderInventory();
                renderOrders();
                renderTransactions();
                renderBatches();
                renderThresholds();
            }

            // Render customer products
            function renderCustomerProducts() {
                const searchTerm = document.getElementById('product-search').value.toLowerCase();
                const categoryFilter = document.getElementById('category-filter').value;
                const sortOption = document.getElementById('sort-price').value;

                // Filter products based on search and category
                let filteredProducts = products.filter(product => {
                    const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                        product.description.toLowerCase().includes(searchTerm);
                    const matchesCategory = categoryFilter === 'all' || product.category === categoryFilter;
                    return matchesSearch && matchesCategory;
                });

                // Sort products based on the selected option
                if (sortOption === 'asc') {
                    filteredProducts.sort((a, b) => a.price - b.price);
                } else if (sortOption === 'desc') {
                    filteredProducts.sort((a, b) => b.price - a.price);
                }
                // For 'default', no sorting is applied

                productGrid.innerHTML = '';

                filteredProducts.forEach(product => {
                    const isInWishlist = wishlist.some(item => item.id === product.id);

                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <div class="product-image">
                            <img src="${product.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-category">${product.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</p>
                            <p class="product-price"><span class="currency"></span>${product.price.toFixed(2)}</p>
                            <div class="product-actions">
                                <button class="btn btn-primary btn-sm add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                <button class="btn btn-success btn-sm buy-now-btn" data-id="${product.id}">Buy Now</button>
                                <button class="btn ${isInWishlist ? 'btn-danger' : 'btn-warning'} btn-sm wishlist-btn" data-id="${product.id}">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="btn btn-primary btn-sm view-details-btn" data-id="${product.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    `;

                    productGrid.appendChild(productCard);
                });

                // Add event listeners to buttons
                addProductEventListeners(productGrid);
            }

            // Add product to cart
            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1,
                        image: product.image
                    });
                }
                
                saveCart();
                updateCartCount();
                renderCustomerProducts();
                renderFeaturedProducts();
                renderNewProducts();
                
                showToast('Added ' + product.name + ' to cart!', 'success');
            }

            // Buy now function
            function buyNow(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                // Clear cart and add only this product
                cart = [{
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    image: product.image
                }];
                
                saveCart();
                updateCartCount();
                openCheckoutModal();
            }

            // Update cart count in header
            function updateCartCount() {
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = totalItems;
            }

            // Open cart modal
            function openCartModal() {
                renderCartItems();
                cartModal.classList.add('active');
            }

            // Close cart modal
            function closeCartModal() {
                cartModal.classList.remove('active');
            }

            // Render cart items
            function renderCartItems() {
                cartItems.innerHTML = '';
                
                if (cart.length === 0) {
                    cartItems.innerHTML = '<p>Your cart is empty.</p>';
                    cartTotalAmount.textContent = '0.00';
                    return;
                }
                
                let total = 0;
                
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (!product) return;
                    
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-image">
                            <img src="${item.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${item.name}">
                        </div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price"><span class="currency"></span>${item.price.toFixed(2)}</div>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn decrease-quantity" data-id="${item.id}">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" data-id="${item.id}">
                            <button class="quantity-btn increase-quantity" data-id="${item.id}">+</button>
                        </div>
                        <div class="cart-item-total"><span class="currency"></span>${itemTotal.toFixed(2)}</div>
                        <button class="btn btn-danger btn-sm remove-from-cart" data-id="${item.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    
                    cartItems.appendChild(cartItem);
                });
                
                cartTotalAmount.textContent = total.toFixed(2);
                
                // Add event listeners
                document.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        updateCartQuantity(productId, -1);
                    });
                });
                
                document.querySelectorAll('.increase-quantity').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        updateCartQuantity(productId, 1);
                    });
                });
                
                document.querySelectorAll('.quantity-input').forEach(input => {
                    input.addEventListener('change', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        const newQuantity = parseInt(e.target.value);
                        setCartQuantity(productId, newQuantity);
                    });
                });
                
                document.querySelectorAll('.remove-from-cart').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        removeFromCart(productId);
                    });
                });
            }

            // Update cart quantity
            function updateCartQuantity(productId, change) {
                const item = cart.find(item => item.id === productId);
                if (!item) return;
                
                const newQuantity = item.quantity + change;
                
                if (newQuantity < 1) {
                    removeFromCart(productId);
                    return;
                }
                
                item.quantity = newQuantity;
                saveCart();
                updateCartCount();
                renderCartItems();
            }

            // Set cart quantity
            function setCartQuantity(productId, quantity) {
                const item = cart.find(item => item.id === productId);
                if (!item) return;
                
                if (quantity < 1) {
                    removeFromCart(productId);
                    return;
                }
                
                item.quantity = quantity;
                
                saveCart();
                updateCartCount();
                renderCartItems();
            }

            // Remove from cart
            function removeFromCart(productId) {
                const itemIndex = cart.findIndex(item => item.id === productId);
                if (itemIndex !== -1) {
                    cart.splice(itemIndex, 1);
                    saveCart();
                    updateCartCount();
                    renderCartItems();
                    renderCustomerProducts();
                    renderFeaturedProducts();
                    renderNewProducts();
                    showToast('Item removed from cart', 'success');
                }
            }

            // Open wishlist modal
            function openWishlistModal() {
                renderWishlistItems();
                wishlistModal.classList.add('active');
            }

            // Close wishlist modal
            function closeWishlistModal() {
                wishlistModal.classList.remove('active');
            }

            // Render wishlist items
            function renderWishlistItems() {
                wishlistItems.innerHTML = '';
                
                if (wishlist.length === 0) {
                    wishlistItems.innerHTML = `
                        <div class="wishlist-empty">
                            <i class="fas fa-heart"></i>
                            <h3>Your wishlist is empty</h3>
                            <p>Save items you love for later</p>
                            <button class="btn btn-primary" id="browse-products-btn">Browse Products</button>
                        </div>
                    `;
                    
                    document.getElementById('browse-products-btn').addEventListener('click', () => {
                        closeWishlistModal();
                        showCustomerDashboard();
                    });
                    return;
                }
                
                wishlist.forEach(item => {
                    const wishlistItem = document.createElement('div');
                    wishlistItem.className = 'wishlist-item';
                    wishlistItem.innerHTML = `
                        <div class="wishlist-item-image">
                            <img src="${item.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${item.name}">
                        </div>
                        <div class="wishlist-item-details">
                            <div class="wishlist-item-name">${item.name}</div>
                            <div class="wishlist-item-price"><span class="currency"></span>${item.price.toFixed(2)}</div>
                        </div>
                        <div class="wishlist-item-actions">
                            <button class="btn btn-primary btn-sm add-to-cart-from-wishlist" data-id="${item.id}">Add to Cart</button>
                            <button class="btn btn-danger btn-sm remove-from-wishlist" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    wishlistItems.appendChild(wishlistItem);
                });
                
                // Add event listeners
                document.querySelectorAll('.add-to-cart-from-wishlist').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        addToCart(productId);
                    });
                });
                
                document.querySelectorAll('.remove-from-wishlist').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        removeFromWishlist(productId);
                    });
                });
            }

            // Remove from wishlist
            function removeFromWishlist(productId) {
                const itemIndex = wishlist.findIndex(item => item.id === productId);
                if (itemIndex !== -1) {
                    wishlist.splice(itemIndex, 1);
                    saveWishlist();
                    renderWishlistItems();
                    renderCustomerProducts();
                    renderFeaturedProducts();
                    renderNewProducts();
                    showToast('Item removed from wishlist', 'success');
                }
            }

            // Open product detail modal
            function openProductDetailModal(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const isInWishlist = wishlist.some(item => item.id === product.id);
                
                const productDetailContent = document.getElementById('product-detail-content');
                productDetailContent.innerHTML = `
                    <div class="product-detail-image">
                        <img src="${product.image || 'https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80'}" alt="${product.name}">
                    </div>
                    <div class="product-detail-info">
                        <h2 class="product-detail-name">${product.name}</h2>
                        <p class="product-detail-price"><span class="currency"></span>${product.price.toFixed(2)}</p>
                        <p class="product-detail-description">${product.description}</p>
                        <div class="product-detail-specs">
                            <h4>Specifications</h4>
                            <p><strong>Category:</strong> ${product.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</p>
                            <p><strong>Dimensions:</strong> ${product.dimensions}</p>
                        </div>
                        <div class="product-detail-actions">
                            <button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                            <button class="btn btn-success buy-now-btn" data-id="${product.id}">Buy Now</button>
                            <button class="btn ${isInWishlist ? 'btn-danger' : 'btn-warning'} wishlist-btn" data-id="${product.id}">
                                <i class="fas fa-heart"></i> ${isInWishlist ? 'Remove from Wishlist' : 'Add to Wishlist'}
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listeners to buttons
                productDetailContent.querySelector('.add-to-cart-btn').addEventListener('click', () => {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to add items to cart', 'error');
                        return;
                    }
                    addToCart(product.id);
                    closeProductDetailModal();
                });
                
                productDetailContent.querySelector('.buy-now-btn').addEventListener('click', () => {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to purchase items', 'error');
                        return;
                    }
                    buyNow(product.id);
                    closeProductDetailModal();
                });
                
                productDetailContent.querySelector('.wishlist-btn').addEventListener('click', () => {
                    if (!currentUser) {
                        showLogin();
                        showLoginMessage('Please log in to add items to wishlist', 'error');
                        return;
                    }
                    toggleWishlist(product.id);
                    closeProductDetailModal();
                });
                
                productDetailModal.classList.add('active');
            }

            // Close product detail modal
            function closeProductDetailModal() {
                productDetailModal.classList.remove('active');
            }

            // Open checkout modal
            function openCheckoutModal() {
                if (cart.length === 0) {
                    showToast('Your cart is empty.', 'error');
                    return;
                }
                
                renderCheckoutItems();
                checkoutModal.classList.add('active');
            }

            // Close checkout modal
            function closeCheckoutModal() {
                checkoutModal.classList.remove('active');
            }

            // Render checkout items
            function renderCheckoutItems() {
                checkoutItems.innerHTML = '';
                
                let total = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    const checkoutItem = document.createElement('div');
                    checkoutItem.className = 'order-item';
                    checkoutItem.innerHTML = `
                        <div class="item-details">
                            <h3>${item.name}</h3>
                            <p>Quantity: ${item.quantity}</p>
                        </div>
                        <div class="item-price"><span class="currency"></span>${itemTotal.toFixed(2)}</div>
                    `;
                    
                    checkoutItems.appendChild(checkoutItem);
                });
                
                checkoutTotal.textContent = total.toFixed(2);
            }

            // Handle checkout
            function handleCheckout() {
                // Basic form validation
                const fullName = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const address = document.getElementById('address').value;
                const city = document.getElementById('city').value;
                const state = document.getElementById('state').value;
                const zipCode = document.getElementById('zipCode').value;
                const selectedPayment = document.querySelector('input[name="payment"]:checked');
                
                if (!fullName || !email || !address || !city || !state || !zipCode) {
                    showToast('Please fill in all required shipping information.', 'error');
                    return;
                }
                
                if (!selectedPayment) {
                    showToast('Please select a payment method.', 'error');
                    return;
                }
                
                // If card payment selected, validate card details
                if (selectedPayment.value === 'card') {
                    const cardNumber = document.getElementById('cardNumber').value;
                    const expiryDate = document.getElementById('expiryDate').value;
                    const cvv = document.getElementById('cvv').value;
                    const cardName = document.getElementById('cardName').value;
                    
                    if (!cardNumber || !expiryDate || !cvv || !cardName) {
                        showToast('Please fill in all card details.', 'error');
                        return;
                    }
                }
                
                // Create new order
                const orderId = orders.length > 0 ? Math.max(...orders.map(o => o.id)) + 1 : 1001;
                const orderDate = new Date().toISOString().split('T')[0];
                const orderAmount = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                
                const newOrder = {
                    id: orderId,
                    customer: currentUser.name,
                    date: orderDate,
                    amount: orderAmount,
                    status: 'pending',
                    items: cart.map(item => ({
                        productId: item.id,
                        quantity: item.quantity,
                        price: item.price
                    }))
                };
                
                orders.push(newOrder);
                saveOrders();
                
                // Update product stock
                cart.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        product.stock -= item.quantity;
                        
                        // Add transaction log
                        const transactionId = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
                        transactions.push({
                            id: transactionId,
                            type: 'sale',
                            user: currentUser.name,
                            item: product.name,
                            quantity: item.quantity,
                            date: new Date().toISOString().replace('T', ' ').substring(0, 19),
                            amount: item.price * item.quantity
                        });
                    }
                });
                
                saveProducts();
                saveTransactions();
                
                // Clear cart
                cart = [];
                saveCart();
                updateCartCount();
                
                // Close checkout modal
                closeCheckoutModal();
                
                // Show success message
                showToast(`Order #${orderId} placed successfully! Total: ${orderAmount.toFixed(2)}`, 'success');
                
                // Update admin stats if admin is viewing
                if (isAdmin) {
                    updateAdminStats();
                    renderInventory();
                    renderOrders();
                    renderTransactions();
                }
            }

            // Show order history
            function showOrderHistory() {
                const userOrders = orders.filter(order => order.customer === currentUser.name);
                
                if (userOrders.length === 0) {
                    showToast('You have no orders yet.', 'info');
                    return;
                }
                
                // Create a modal to display order history
                const orderHistoryModal = document.createElement('div');
                orderHistoryModal.className = 'modal active';
                orderHistoryModal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" id="close-order-history">&times;</button>
                        <h2 class="modal-title">Your Order History</h2>
                        <div class="dashboard-section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${userOrders.map(order => `
                                        <tr>
                                            <td>${order.id}</td>
                                            <td>${order.date}</td>
                                            <td>${order.items.length} item(s)</td>
                                            <td><span class="currency"></span>${order.amount.toFixed(2)}</td>
                                            <td>${order.status}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(orderHistoryModal);
                
                // Add close event
                document.getElementById('close-order-history').addEventListener('click', () => {
                    orderHistoryModal.remove();
                });
            }

            // Open profile modal with enhanced functionality
            function openProfileModal() {
                if (!currentUser) {
                    showLogin();
                    showLoginMessage('Please log in to view your profile', 'error');
                    return;
                }
                
                // If admin, don't open profile modal (should logout instead)
                if (isAdmin) {
                    adminLogout();
                    return;
                }
                
                // Populate profile data
                document.getElementById('profile-name').textContent = currentUser.name || currentUser.username;
                document.getElementById('profile-email').textContent = currentUser.email || 'N/A';
                document.getElementById('profile-role').textContent = isAdmin ? 'Administrator' : 'Customer';
                
                document.getElementById('profile-fullname').value = currentUser.name || '';
                document.getElementById('profile-email-input').value = currentUser.email || '';
                document.getElementById('profile-username').value = currentUser.username || '';
                document.getElementById('profile-phone').value = currentUser.phone || '';
                document.getElementById('profile-address').value = currentUser.address || '';
                
                // Calculate and display profile stats
                updateProfileStats();
                
                // Reset password form
                document.getElementById('password-form').reset();
                document.getElementById('update-password-btn').disabled = true;
                
                // Reset requirement indicators
                const requirements = document.querySelectorAll('#profile-password-requirements .requirement');
                requirements.forEach(req => {
                    const icon = req.querySelector('i');
                    req.classList.remove('valid', 'invalid');
                    icon.classList.remove('fa-check', 'fa-times');
                    icon.classList.add('fa-times');
                });
                
                // Load order history
                renderProfileOrders();
                
                profileModal.classList.add('active');
            }

            // Update profile statistics
            function updateProfileStats() {
                // Calculate orders count
                const userOrders = orders.filter(order => order.customer === currentUser.name);
                document.getElementById('profile-orders-count').textContent = userOrders.length;
                
                // Calculate wishlist count
                document.getElementById('profile-wishlist-count').textContent = wishlist.length;
                
                // Set member since year
                const memberSince = currentUser.createdAt ? new Date(currentUser.createdAt).getFullYear() : new Date().getFullYear();
                document.getElementById('profile-member-since').textContent = memberSince;
            }

            // Render profile orders with backend integration
            async function renderProfileOrders() {
                const profileOrders = document.getElementById('profile-orders');
                profileOrders.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-hourglass-half"></i>
                        <h3>Loading Orders...</h3>
                    </div>
                `;
                
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch('http://127.0.0.1:5000/api/user/orders', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch orders');
                    }
                    
                    const data = await response.json();
                    const userOrders = data.orders || [];
                    
                    if (userOrders.length === 0) {
                        profileOrders.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-shopping-bag"></i>
                                <h3>No Orders Yet</h3>
                                <p>You haven't placed any orders yet.</p>
                                <button class="btn btn-primary" id="start-shopping-btn">Start Shopping</button>
                            </div>
                        `;
                        
                        document.getElementById('start-shopping-btn').addEventListener('click', () => {
                            closeProfileModal();
                            showCustomerDashboard();
                        });
                        return;
                    }
                    
                    // Sort orders by date (newest first)
                    userOrders.sort((a, b) => new Date(b.order_date) - new Date(a.order_date));
                    
                    profileOrders.innerHTML = '';
                    
                    userOrders.forEach(order => {
                        const orderCard = document.createElement('div');
                        orderCard.className = 'order-card';
                        const orderItems = order.items || [];
                        
                        // Calculate total items
                        const totalItems = orderItems.reduce((sum, item) => sum + item.quantity, 0);
                        
                        orderCard.innerHTML = `
                            <div class="order-header">
                                <div>
                                    <div class="order-id">Order #${order.id}</div>
                                    <div class="order-date">Placed on ${formatDate(order.order_date)}</div>
                                </div>
                                <div class="order-status ${order.status}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</div>
                            </div>
                            <div class="order-details">
                                <div class="order-items">
                                    ${orderItems.map(item => {
                                        return `
                                            <div class="order-item">
                                                <div class="order-item-name">${item.product_name || 'Unknown Product'}</div>
                                                <div class="order-item-quantity">Qty: ${item.quantity}</div>
                                                <div class="order-item-price"><span class="currency"></span>${(item.price * item.quantity).toFixed(2)}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                                <div class="order-total">
                                    <span>Total:</span>
                                    <span><span class="currency"></span>${(order.total_amount || 0).toFixed(2)}</span>
                                </div>
                                <div class="order-actions">
                                    <button class="btn btn-primary btn-sm view-order-details-btn" data-id="${order.id}">View Details</button>
                                    ${order.status === 'pending' ? `<button class="btn btn-danger btn-sm cancel-order-btn" data-id="${order.id}">Cancel Order</button>` : ''}
                                    ${order.status === 'completed' ? `<button class="btn btn-success btn-sm reorder-btn" data-id="${order.id}">Reorder</button>` : ''}
                                </div>
                            </div>
                        `;
                        
                        profileOrders.appendChild(orderCard);
                    });
                    
                    // Add event listeners to order action buttons
                    document.querySelectorAll('.view-order-details-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const orderId = parseInt(e.target.getAttribute('data-id'));
                            viewOrderDetails(orderId);
                        });
                    });
                    
                    document.querySelectorAll('.cancel-order-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                                const orderId = parseInt(e.target.getAttribute('data-id'));
                                cancelOrder(orderId);
                            });
                    });
                    
                        document.querySelectorAll('.reorder-btn').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const orderId = parseInt(e.target.getAttribute('data-id'));
                                reorderItems(orderId);
                            });
                    });
                    } catch (error) {
                        console.error('Error loading orders:', error);
                        profileOrders.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-exclamation-circle"></i>
                                <h3>Error Loading Orders</h3>
                                <p>Unable to load your orders. Please try again later.</p>
                            </div>
                        `;
                    }
            }

            // Format date for display
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }

            // View order details in profile
            function viewOrderDetails(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                const orderDetailsModal = document.createElement('div');
                orderDetailsModal.className = 'modal active';
                orderDetailsModal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" id="close-order-details-profile">&times;</button>
                        <h2 class="modal-title">Order #${order.id} Details</h2>
                        <div class="dashboard-section">
                            <div class="order-header">
                                <div>
                                    <div class="order-id">Order #${order.id}</div>
                                    <div class="order-date">Placed on ${formatDate(order.date)}</div>
                                </div>
                                <div class="order-status ${order.status}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</div>
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <h3>Shipping Information</h3>
                                <p><strong>Customer:</strong> ${order.customer}</p>
                                <p><strong>Shipping Address:</strong> ${order.shippingAddress || 'Not specified'}</p>
                                <p><strong>Contact:</strong> ${order.contactPhone || 'Not specified'}</p>
                            </div>
                            
                            <h3>Items</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${order.items.map(item => {
                                        const product = products.find(p => p.id === item.productId);
                                        return `
                                            <tr>
                                                <td>${product ? product.name : 'Unknown Product'}</td>
                                                <td>${item.quantity}</td>
                                                <td><span class="currency"></span>${item.price.toFixed(2)}</td>
                                                <td><span class="currency"></span>${(item.quantity * item.price).toFixed(2)}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                            
                            <div class="order-total" style="margin-top: 20px;">
                                <span>Total:</span>
                                <span><span class="currency"></span>${order.amount.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(orderDetailsModal);
                
                // Add close event
                document.getElementById('close-order-details-profile').addEventListener('click', () => {
                    orderDetailsModal.remove();
                });
            }

            // Cancel order
            function cancelOrder(orderId) {
                if (!confirm('Are you sure you want to cancel this order?')) return;
                
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                if (order.status === 'pending') {
                    order.status = 'cancelled';
                    
                    // Restore product stock
                    order.items.forEach(item => {
                        const product = products.find(p => p.id === item.productId);
                        if (product) {
                            product.stock += item.quantity;
                        }
                    });
                    
                    saveOrders();
                    saveProducts();
                    renderProfileOrders();
                    showToast(`Order #${orderId} has been cancelled`, 'success');
                    
                    // Update admin stats if admin is viewing
                    if (isAdmin) {
                        updateAdminStats();
                        renderInventory();
                        renderOrders();
                    }
                } else {
                    showToast('Only pending orders can be cancelled', 'error');
                }
            }

            // Reorder items
            function reorderItems(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                // Clear current cart and add order items
                cart = [];
                
                order.items.forEach(item => {
                    const product = products.find(p => p.id === item.productId);
                    if (product && product.stock > 0) {
                        const quantity = Math.min(item.quantity, product.stock);
                        
                        cart.push({
                            id: product.id,
                            name: product.name,
                            price: product.price,
                            quantity: quantity,
                            image: product.image
                        });
                    }
                });
                
                if (cart.length > 0) {
                    saveCart();
                    updateCartCount();
                    closeProfileModal();
                    openCartModal();
                    showToast('Items added to cart from your previous order', 'success');
                } else {
                    showToast('None of the items from this order are currently available', 'error');
                }
            }

            // Close profile modal
            function closeProfileModal() {
                profileModal.classList.remove('active');
            }

            // Update profile with enhanced validation
            async function updateProfile(e) {
                e.preventDefault();
                
                const name = document.getElementById('profile-fullname').value;
                const email = document.getElementById('profile-email-input').value;
                const username = document.getElementById('profile-username').value;
                const phone = document.getElementById('profile-phone').value;
                const address = document.getElementById('profile-address').value;
                
                // Basic validation
                if (!name || !email || !username) {
                    showToast('Please fill in all required fields', 'error');
                    return;
                }
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showToast('Please enter a valid email address', 'error');
                    return;
                }
                
                // Send update to backend
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch('http://127.0.0.1:5000/api/user/profile', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            full_name: name,
                            email: email,
                            username: username,
                            phone: phone,
                            address: address
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        // Update current user locally
                        currentUser.name = name;
                        currentUser.email = email;
                        currentUser.username = username;
                        currentUser.phone = phone;
                        currentUser.address = address;
                        
                        // Save updated user
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // Update profile display
                        document.getElementById('profile-name').textContent = name;
                        document.getElementById('profile-email').textContent = email;
                        
                        showToast('Profile updated successfully!', 'success');
                    } else {
                        showToast(result.msg || 'Failed to update profile', 'error');
                    }
                } catch (error) {
                    console.error('Profile update error:', error);
                    showToast('Error updating profile. Please try again.', 'error');
                }
            }

            // Update password with enhanced security
            async function updatePassword(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-new-password').value;
                
                // Check if new passwords match
                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match', 'error');
                    return;
                }
                
                // Validate password requirements
                if (!validateProfilePassword()) {
                    showToast('New password does not meet requirements', 'error');
                    return;
                }
                
                // Check if new password is different from current
                if (currentPassword === newPassword) {
                    showToast('New password must be different from current password', 'error');
                    return;
                }
                
                // Send password change request to backend
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch('http://127.0.0.1:5000/api/auth/change-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            current_password: currentPassword,
                            new_password: newPassword
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        showToast('Password changed successfully!', 'success');
                        
                        // Clear form
                        document.getElementById('password-form').reset();
                        document.getElementById('update-password-btn').disabled = true;
                        
                        // Reset requirement indicators
                        const requirements = document.querySelectorAll('#profile-password-requirements .requirement');
                        requirements.forEach(req => {
                            const icon = req.querySelector('i');
                            req.classList.remove('valid', 'invalid');
                            icon.classList.remove('fa-check', 'fa-times');
                            icon.classList.add('fa-times');
                        });
                    } else {
                        showToast(result.msg || 'Password change failed', 'error');
                    }
                } catch (error) {
                    console.error('Password change error:', error);
                    showToast('Error changing password. Please try again.', 'error');
                }
            }

            // Save security settings
            function saveSecuritySettings() {
                const twoFactorEnabled = document.getElementById('two-factor-toggle').checked;
                const loginNotificationsEnabled = document.getElementById('login-notifications-toggle').checked;
                
                // In a real application, you would save these settings to the server
                currentUser.twoFactorEnabled = twoFactorEnabled;
                currentUser.loginNotificationsEnabled = loginNotificationsEnabled;
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showToast('Security settings saved successfully!', 'success');
            }

            // View active sessions
            function viewActiveSessions() {
                // In a real application, this would fetch active sessions from the server
                const sessions = [
                    { id: 1, device: 'Chrome on Windows', location: 'Manila, Philippines', lastActive: '2023-10-20 10:30:00', current: true },
                    { id: 2, device: 'Safari on iPhone', location: 'Quezon City, Philippines', lastActive: '2023-10-19 15:45:00', current: false }
                ];
                
                const sessionsModal = document.createElement('div');
                sessionsModal.className = 'modal active';
                sessionsModal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" id="close-sessions-modal">&times;</button>
                        <h2 class="modal-title">Active Sessions</h2>
                        <div class="dashboard-section">
                            <p>These are the devices that are currently logged into your account.</p>
                            
                            <table style="width: 100%; margin-top: 20px;">
                                <thead>
                                    <tr>
                                        <th>Device</th>
                                        <th>Location</th>
                                        <th>Last Active</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${sessions.map(session => `
                                        <tr>
                                            <td>${session.device} ${session.current ? '<span style="color: var(--success);">(Current)</span>' : ''}</td>
                                            <td>${session.location}</td>
                                            <td>${session.lastActive}</td>
                                            <td>
                                                ${!session.current ? `<button class="btn btn-danger btn-sm revoke-session-btn" data-id="${session.id}">Revoke</button>` : ''}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn btn-danger" id="revoke-all-sessions-btn">Revoke All Other Sessions</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(sessionsModal);
                
                // Add close event
                document.getElementById('close-sessions-modal').addEventListener('click', () => {
                    sessionsModal.remove();
                });
                
                // Add revoke session events
                document.querySelectorAll('.revoke-session-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const sessionId = parseInt(e.target.getAttribute('data-id'));
                        // In a real application, this would revoke the session on the server
                        showToast(`Session #${sessionId} revoked`, 'success');
                        sessionsModal.remove();
                    });
                });
                
                // Add revoke all sessions event
                document.getElementById('revoke-all-sessions-btn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to revoke all other sessions? This will log you out from all other devices.')) {
                        // In a real application, this would revoke all sessions except the current one
                        showToast('All other sessions revoked', 'success');
                        sessionsModal.remove();
                    }
                });
            }

            // Update admin statistics
            function updateAdminStats() {
                totalProducts.textContent = products.length;
                
                const lowStockItems = products.filter(p => {
                    const threshold = p.threshold || adminSettings.globalThreshold;
                    return p.stock < threshold;
                }).length;
                lowStockCount.textContent = lowStockItems;
                
                const salesTotal = orders.reduce((total, order) => total + order.amount, 0);
                totalSales.textContent = salesTotal.toFixed(2);
                
                const pendingCount = orders.filter(order => order.status === 'pending').length;
                pendingOrders.textContent = pendingCount;
                
                // Show low stock alerts
                renderAdminAlerts();
            }

            // Render inventory table
            function renderInventory() {
                inventoryTable.innerHTML = '';
                inventoryAlerts.innerHTML = '';
                
                const lowStockProducts = products.filter(p => {
                    const threshold = p.threshold || adminSettings.globalThreshold;
                    return p.stock < threshold;
                });
                
                if (lowStockProducts.length > 0 && adminSettings.dashboardAlerts) {
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-warning';
                    alert.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${lowStockProducts.length} product(s) are low in stock.`;
                    inventoryAlerts.appendChild(alert);
                }
                
                products.forEach(product => {
                    const threshold = product.threshold || adminSettings.globalThreshold;
                    const isLowStock = product.stock < threshold;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</td>
                        <td class="${isLowStock ? 'low-stock' : ''}">${product.stock}</td>
                        <td>${product.dimensions}</td>
                        <td><span class="currency"></span>${product.price.toFixed(2)}</td>
                        <td>${isLowStock ? 'Low Stock' : 'In Stock'}</td>
                        <td>
                            <button class="btn btn-warning btn-sm edit-product-btn" data-id="${product.id}">Edit</button>
                            <button class="btn btn-primary btn-sm update-stock-btn" data-id="${product.id}">Update Stock</button>
                            <button class="btn btn-danger btn-sm delete-product-btn" data-id="${product.id}">Delete</button>
                        </td>
                    `;
                    
                    inventoryTable.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.edit-product-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        openProductModal(productId);
                    });
                });
                
                document.querySelectorAll('.update-stock-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        openStockModal(productId);
                    });
                });
                
                document.querySelectorAll('.delete-product-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const productId = parseInt(e.target.getAttribute('data-id'));
                        deleteProduct(productId);
                    });
                });

                // Make product names editable
                makeProductNameEditable();
            }

            // Render orders table
            function renderOrders() {
                ordersTable.innerHTML = '';
                // Get filter value
                const filterValue = document.getElementById('order-filter').value;
                
                // Filter orders if needed
                const filteredOrders = filterValue === 'all' 
                    ? orders 
                    : orders.filter(order => order.status === filterValue);
                
                filteredOrders.forEach(order => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.customer}</td>
                        <td>${order.date}</td>
                        <td>${order.items.length} item(s)</td>
                        <td><span class="currency"></span>${order.amount.toFixed(2)}</td>
                        <td>
                            <select class="status-dropdown ${order.status}" data-order-id="${order.id}">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                            </select>
                        </td>
                        <td>
                            <div class="status-actions">
                                <button class="btn btn-primary btn-sm view-order-btn" data-id="${order.id}">View</button>
                                <button class="btn btn-success btn-sm update-status-btn" data-id="${order.id}">Update</button>
                            </div>
                        </td>
                    `;
                    
                    ordersTable.appendChild(row);
                });
                
                // Add event listeners to buttons
                document.querySelectorAll('.view-order-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = parseInt(e.target.getAttribute('data-id'));
                        viewOrderDetails(orderId);
                    });
                });
                
                // Add event listeners to update buttons
                document.querySelectorAll('.update-status-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const orderId = parseInt(e.target.getAttribute('data-id'));
                        updateOrderStatus(orderId);
                    });
                });

                // Add event listeners to status dropdowns for dynamic color change
                document.querySelectorAll('.status-dropdown').forEach(dropdown => {
                    dropdown.addEventListener('change', function() {
                        // Remove all status classes
                        this.classList.remove('pending', 'processing', 'completed', 'cancelled');
                        // Add the class for the newly selected status
                        this.classList.add(this.value);
                    });
                });
            }

            // View order details
            function viewOrderDetails(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                const orderDetailsModal = document.createElement('div');
                orderDetailsModal.className = 'modal active';
                orderDetailsModal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" id="close-order-details">&times;</button>
                        <h2 class="modal-title">Order #${order.id} Details</h2>
                        <div class="dashboard-section">
                            <p><strong>Customer:</strong> ${order.customer}</p>
                            <p><strong>Date:</strong> ${order.date}</p>
                            <p><strong>Status:</strong> ${order.status}</p>
                            <p><strong>Total Amount:</strong> <span class="currency"></span>${order.amount.toFixed(2)}</p>
                            
                            <h3>Items</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${order.items.map(item => {
                                        const product = products.find(p => p.id === item.productId);
                                        return `
                                            <tr>
                                                <td>${product ? product.name : 'Unknown Product'}</td>
                                                <td>${item.quantity}</td>
                                                <td><span class="currency"></span>${item.price.toFixed(2)}</td>
                                                <td><span class="currency"></span>${(item.quantity * item.price).toFixed(2)}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(orderDetailsModal);
                
                // Add close event
                document.getElementById('close-order-details').addEventListener('click', () => {
                    orderDetailsModal.remove();
                });
            }

            // Update order status
            function updateOrderStatus(orderId) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;
                
                const dropdown = document.querySelector(`.status-dropdown[data-order-id="${orderId}"]`);
                const newStatus = dropdown.value;
                
                if (newStatus && ['pending', 'processing', 'completed', 'cancelled'].includes(newStatus)) {
                    const oldStatus = order.status;
                    order.status = newStatus;
                    
                    // Add transaction log for status change
                    const transactionId = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
                    transactions.push({
                        id: transactionId,
                        type: 'status_change',
                        user: 'Admin',
                        item: `Order #${orderId}`,
                        quantity: 1,
                        date: new Date().toISOString().replace('T', ' ').substring(0, 19),
                        amount: 0,
                        details: `Status changed from ${oldStatus} to ${newStatus}`
                    });
                    
                    saveOrders();
                    saveTransactions();
                    
                    // Show success message
                    showToast(`Order #${orderId} status updated to ${newStatus}`, 'success');
                    
                    // If filtered, re-render the table to reflect changes
                    const currentFilter = document.getElementById('order-filter').value;
                    if (currentFilter !== 'all' && currentFilter !== newStatus) {
                        renderOrders();
                    }
                } else {
                    showToast('Invalid status selected.', 'error');
                }
            }

            // Render transaction logs
            function renderTransactions() {
                transactionLogs.innerHTML = '';
                
                transactions.forEach(transaction => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'admin-log-entry';
                    
                    let typeIcon = '';
                    let typeClass = '';
                    
                    switch(transaction.type) {
                        case 'sale':
                            typeIcon = '<i class="fas fa-shopping-cart"></i>';
                            typeClass = 'sale';
                            break;
                        case 'purchase':
                            typeIcon = '<i class="fas fa-box"></i>';
                            typeClass = 'purchase';
                            break;
                        case 'restock':
                            typeIcon = '<i class="fas fa-arrow-up"></i>';
                            typeClass = 'restock';
                            break;
                    }
                    
                    logEntry.innerHTML = `
                        <div>
                            <span class="admin-log-timestamp">${transaction.date}</span>
                            <span class="admin-log-action ${typeClass}">${typeIcon} ${transaction.type.toUpperCase()}</span>
                            by <span class="admin-log-user">${transaction.user}</span>:
                            <span class="admin-log-item">${transaction.quantity} x ${transaction.item}</span>
                            ${transaction.amount > 0 ? `- <span class="currency"></span>${transaction.amount.toFixed(2)}` : ''}
                        </div>
                    `;
                    
                    transactionLogs.appendChild(logEntry);
                });
            }

            // Render inventory batches
            function renderBatches() {
                batchTable.innerHTML = '';
                
                batches.forEach(batch => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${batch.id}</td>
                        <td>${batch.productName}</td>
                        <td>${batch.arrivalDate}</td>
                        <td>${batch.quantity}</td>
                        <td>${batch.remaining}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-batch-btn" data-id="${batch.id}">Delete</button>
                        </td>
                    `;
                    
                    batchTable.appendChild(row);
                });
            }

            // Render threshold settings
            function renderThresholds() {
                thresholdTable.innerHTML = '';
                
                thresholds.forEach(threshold => {
                    const product = products.find(p => p.id === threshold.productId);
                    const isLowStock = product && product.stock < threshold.threshold;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${threshold.productName}</td>
                        <td>${product ? product.stock : 'N/A'}</td>
                        <td>${threshold.threshold}</td>
                        <td>${isLowStock ? 'Low Stock' : 'OK'}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-threshold-btn" data-id="${threshold.productId}">Remove</button>
                        </td>
                    `;
                    
                    thresholdTable.appendChild(row);
                });
            }

            // Render low stock alerts
            function renderAdminAlerts() {
                inventoryAlerts.innerHTML = '';
                
                const lowStockProducts = products.filter(p => {
                    const threshold = p.threshold || adminSettings.globalThreshold;
                    return p.stock < threshold;
                });
                
                if (lowStockProducts.length > 0 && adminSettings.dashboardAlerts) {
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-warning';
                    alert.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${lowStockProducts.length} product(s) are low in stock.`;
                    inventoryAlerts.appendChild(alert);
                }
            }

            // Open product modal for adding or editing
            function openProductModal(productId = null) {
                const modalTitle = document.getElementById('product-modal-title');
                const form = document.getElementById('product-form');
                
                if (productId) {
                    // Edit existing product
                    modalTitle.textContent = 'Edit Product';
                    const product = products.find(p => p.id === productId);
                    
                    if (product) {
                        document.getElementById('product-name').value = product.name;
                        document.getElementById('product-category').value = product.category;
                        document.getElementById('product-price').value = product.price;
                        document.getElementById('product-stock').value = product.stock;
                        document.getElementById('product-dimensions').value = product.dimensions;
                        document.getElementById('product-description').value = product.description;
                        document.getElementById('product-image').value = product.image || '';
                        document.getElementById('product-threshold').value = product.threshold || '';
                        
                        form.setAttribute('data-editing-id', productId);
                    }
                } else {
                    // Add new product
                    modalTitle.textContent = 'Add New Product';
                    form.reset();
                    form.removeAttribute('data-editing-id');
                }
                
                productModal.classList.add('active');
            }

            // Close product modal
            function closeProductModal() {
                productModal.classList.remove('active');
            }

            // Handle product form submission
            // Enhanced product form submission
            function handleProductFormSubmit(e) {
                e.preventDefault();
                
                const editingId = document.getElementById('product-form').getAttribute('data-editing-id');
                const name = document.getElementById('product-name').value;
                const category = document.getElementById('product-category').value;
                const price = parseFloat(document.getElementById('product-price').value);
                const stock = parseInt(document.getElementById('product-stock').value);
                const dimensions = document.getElementById('product-dimensions').value;
                const description = document.getElementById('product-description').value;
                const image = document.getElementById('product-image').value;
                const threshold = document.getElementById('product-threshold').value ? 
                    parseInt(document.getElementById('product-threshold').value) : null;
                
                const updates = {
                    name,
                    category,
                    price,
                    stock,
                    dimensions,
                    description,
                    image,
                    threshold
                };
                
                if (editingId) {
                    // Update existing product
                    const success = updateProductAndUI(parseInt(editingId), updates);
                    if (success) {
                        showToast('Product updated successfully!', 'success');
                    } else {
                        showToast('Failed to update product', 'error');
                    }
                } else {
                    // Add new product
                    const newId = productManager.products.length > 0 ? 
                        Math.max(...productManager.products.map(p => p.id)) + 1 : 1;
                    
                    const newProduct = {
                        id: newId,
                        ...updates,
                        featured: false,
                        new: true
                    };
                    
                    productManager.products.push(newProduct);
                    productManager.saveProducts();
                    productManager.notifySubscribers();
                    
                    showToast('Product added successfully!', 'success');
                }
                
                closeProductModal();
            }

            // Open stock modal
            function openStockModal(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                document.getElementById('stock-product').value = product.name;
                document.getElementById('stock-quantity').value = product.stock;
                document.getElementById('stock-form').setAttribute('data-product-id', productId);
                
                stockModal.classList.add('active');
            }

            // Close stock modal
            function closeStockModal() {
                stockModal.classList.remove('active');
            }

            // Handle stock form submission
            function handleStockFormSubmit(e) {
                e.preventDefault();
                
                const productId = parseInt(document.getElementById('stock-form').getAttribute('data-product-id'));
                const action = document.getElementById('stock-action').value;
                const quantity = parseInt(document.getElementById('stock-quantity').value);
                const reason = document.getElementById('stock-reason').value;
                
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                let newStock = product.stock;
                
                switch(action) {
                    case 'restock':
                        newStock += quantity;
                        break;
                    case 'adjust':
                        newStock = Math.max(0, product.stock + quantity);
                        break;
                    case 'set':
                        newStock = quantity;
                        break;
                }
                
                // Update product stock
                product.stock = newStock;
                
                // Add transaction log
                const transactionId = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;
                transactions.push({
                    id: transactionId,
                    type: action === 'restock' ? 'restock' : 'adjustment',
                    user: 'Admin',
                    item: product.name,
                    quantity: Math.abs(newStock - product.stock),
                    date: new Date().toISOString().replace('T', ' ').substring(0, 19),
                    amount: 0
                });
                
                saveProducts();
                saveTransactions();
                closeStockModal();
                
                updateAdminStats();
                renderInventory();
                renderTransactions();
                
                showToast('Stock updated successfully!', 'success');
            }

            // Delete product
            function deleteProduct(productId) {
                if (!confirm('Are you sure you want to delete this product?')) return;
                
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    products.splice(productIndex, 1);
                    saveProducts();
                    
                    updateAdminStats();
                    renderInventory();
                    
                    showToast('Product deleted successfully!', 'success');
                }
            }

            // Generate report
            function generateReport() {
                const totalSales = orders.reduce((total, order) => total + order.amount, 0);
                const totalOrders = orders.length;
                const lowStockCount = products.filter(p => {
                    const threshold = p.threshold || adminSettings.globalThreshold;
                    return p.stock < threshold;
                }).length;
                
                // Find top category
                const categoryCount = {};
                products.forEach(product => {
                    categoryCount[product.category] = (categoryCount[product.category] || 0) + 1;
                });
                const topCategory = Object.keys(categoryCount).reduce((a, b) => 
                    categoryCount[a] > categoryCount[b] ? a : b, 'N/A');
                
                // Update report summary
                document.getElementById('report-total-sales').textContent = totalSales.toFixed(2);
                document.getElementById('report-total-orders').textContent = totalOrders;
                document.getElementById('report-low-stock').textContent = lowStockCount;
                document.getElementById('report-top-category').textContent = topCategory.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                
                // Generate report details
                const reportDetails = document.getElementById('report-details');
                reportDetails.innerHTML = `
                    <h3>Inventory Status Report</h3>
                    <p><strong>Report Date:</strong> ${new Date().toLocaleDateString()}</p>
                    
                    <h4>Product Summary by Category</h4>
                    <ul>
                        <li>Sofas: ${products.filter(p => p.category === 'sofa').length} products</li>
                        <li>Single Sofas: ${products.filter(p => p.category === 'single-sofa').length} products</li>
                        <li>Gaming Chairs: ${products.filter(p => p.category === 'gaming-chair').length} products</li>
                        <li>Gaming Tables: ${products.filter(p => p.category === 'gaming-table').length} products</li>
                        <li>Dining Tables: ${products.filter(p => p.category === 'dining-table').length} products</li>
                        <li>Coffee Tables: ${products.filter(p => p.category === 'coffee-table').length} products</li>
                        <li>Shoe Racks: ${products.filter(p => p.category === 'shoe-rack').length} products</li>
                        <li>Dressers: ${products.filter(p => p.category === 'dresser').length} products</li>
                        <li>Shelves: ${products.filter(p => p.category === 'shelf').length} products</li>
                        <li>Wall Shelves: ${products.filter(p => p.category === 'wall-shelf').length} products</li>
                        <li>Lamps: ${products.filter(p => p.category === 'lamp').length} products</li>
                    </ul>
                    
                    <h4>Low Stock Items</h4>
                    <ul>
                        ${products.filter(p => {
                            const threshold = p.threshold || adminSettings.globalThreshold;
                            return p.stock < threshold;
                        }).map(p => `<li>${p.name} (Stock: ${p.stock}, Threshold: ${p.threshold || adminSettings.globalThreshold})</li>`).join('')}
                    </ul>
                    
                    <h4>Recent Transactions</h4>
                    <ul>
                        ${transactions.slice(0, 5).map(t => `<li>${t.date} - ${t.type} - ${t.item} - <span class="currency"></span>${t.amount}</li>`).join('')}
                    </ul>
                `;
                
                // Switch to reports tab
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelector('[data-tab="reports"]').classList.add('active');
                document.getElementById('reports-tab').classList.add('active');
                
                showToast('Report generated successfully!', 'success');
            }

            // Generate period-based report
            function generatePeriodReport() {
                // This would generate a report based on the selected period
                showToast('Period-based report generation would be implemented here.', 'info');
            }

            // Save alert settings
            function saveAlertSettings() {
                adminSettings.globalThreshold = parseInt(document.getElementById('global-threshold').value);
                adminSettings.emailAlerts = document.getElementById('email-alerts-toggle').checked;
                adminSettings.dashboardAlerts = document.getElementById('dashboard-alerts-toggle').checked;
                adminSettings.fifoEnabled = document.getElementById('fifo-toggle').checked;
                
                saveAdminSettings();
                updateAdminStats();
                
                showToast('Alert settings saved successfully!', 'success');
            }

            // Support chat functions
            // Logout
            function logout() {
                currentUser = null;
                isAdmin = false;
                localStorage.removeItem('currentUser');
                localStorage.removeItem('token'); // Remove token on logout
                closeProfileModal();
                showLogin();
                showToast('You have been logged out.', 'info');
                updateNavigation();
            }

            // Save functions
            function saveCustomers() {
                localStorage.setItem('customers', JSON.stringify(customers));
            }

            function saveProducts() {
                // Delegate saving to the ProductManager to keep it as the single source of truth.
                productManager.saveProducts();
            }

            // Function to update navigation based on user role
            function updateNavigation() {
                const nav = document.querySelector('nav ul');
                const customerNavItems = document.querySelectorAll('.customer-nav');
                const profileLink = document.getElementById('nav-profile');

                if (isAdmin) {
                    // Add admin class to nav to ensure CSS hides customer items immediately
                    if (nav && !nav.classList.contains('admin-nav')) nav.classList.add('admin-nav');

                    // As a fallback ensure items are hidden via inline styles
                    customerNavItems.forEach(item => item.style.display = 'none');

                    // Update profile click handler for admin (logout only)
                    profileLink.onclick = function(e) {
                        e.preventDefault();
                        adminLogout();
                    };

                    // Update profile tooltip for admin
                    profileLink.title = "Logout";
                } else {
                    // Remove admin class so customer nav shows
                    if (nav && nav.classList.contains('admin-nav')) nav.classList.remove('admin-nav');

                    // Restore customer navigation items
                    customerNavItems.forEach(item => item.style.display = 'list-item');

                    // Restore original profile click handler for customers
                    profileLink.onclick = function(e) {
                        e.preventDefault();
                        openProfileModal();
                    };

                    // Update profile tooltip for customer
                    profileLink.title = "Profile";
                }
            }

            // Function to handle admin logout
            function adminLogout() {
                const adminLogoutModal = document.getElementById('admin-logout-modal');
                adminLogoutModal.classList.add('active');
            }

            function saveOrders() {
                localStorage.setItem('orders', JSON.stringify(orders));
            }

            function saveBatches() {
                localStorage.setItem('batches', JSON.stringify(batches));
            }

            function saveThresholds() {
                localStorage.setItem('thresholds', JSON.stringify(thresholds));
            }

            function saveTransactions() {
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }

            function saveAdminSettings() {
                localStorage.setItem('adminSettings', JSON.stringify(adminSettings));
            }

            function saveCart() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            function saveWishlist() {
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
            }

            // Tab functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            document.getElementById("signup-form").addEventListener("submit", async (e) => {
                e.preventDefault();

                const name = document.getElementById("signup-name").value;
                const email = document.getElementById("signup-email").value;
                const username = document.getElementById("signup-username").value;
                const password = document.getElementById("signup-password").value;

                const response = await fetch("http://127.0.0.1:5000/api/auth/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        full_name: name,
                        email: email,
                        username: username,
                        password: password
                    })
                });

                const result = await response.json();
                if (response.ok) {
                    alert("Account created successfully!");
                } else {
                    alert("Signup failed: " + result.msg);
                }
            });

            async function placeOrder() {
                // Assuming you already have `currentUser` saved after login
                const orderData = {
                    user_id: currentUser.id,
                    total_amount: calculateTotalAmount(),  // you can replace this with your own function
                    items: cartItems.map(item => ({
                        product_id: item.id,
                        qty: item.qty,
                        price: item.price
                    }))
                };

                const response = await fetch("http://127.0.0.1:5000/api/orders", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();
                if (response.ok) {
                    alert("Order placed successfully!");
                    // Optionally: clear cart or redirect
                    cartItems = [];
                    updateCartDisplay();
                } else {
                    alert("Error: " + result.msg);
                }
            }

            // Example: connect it to your checkout button
            document.getElementById("checkout-btn").addEventListener("click", placeOrder);

            
        </script>
    </body>
    </html>